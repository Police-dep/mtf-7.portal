<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTF-7 SECURE DATABASE</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        /* === ПЕРЕМЕННЫЕ ДЛЯ ТЕМ === */
        :root {
            /* Темная тема (по умолчанию) */
            --bg-body: #050505;
            --bg-panel: #0f0f0f;
            --bg-input: #141414;
            --bg-hover: #1a1a1a;
            --border: #333333;
            --text-main: #e0e0e0;
            --text-dim: #888888;
            --text-muted: #666666;
            --accent: #ffffff;
            --danger: #cf3434;
            --success: #2e8b57;
            --warning: #ff9900;
            --font-stack: 'JetBrains Mono', monospace;
            --card-border: #ffffff;
            --shadow: rgba(0, 0, 0, 0.8);
            --sidebar-bg: #0f0f0f;
        }

        .light-theme {
            /* Светлая тема */
            --bg-body: #f5f5f5;
            --bg-panel: #ffffff;
            --bg-input: #f0f0f0;
            --bg-hover: #f8f8f8;
            --border: #dddddd;
            --text-main: #222222;
            --text-dim: #555555;
            --text-muted: #777777;
            --accent: #000000;
            --danger: #d32f2f;
            --success: #2e7d32;
            --warning: #f57c00;
            --font-stack: 'JetBrains Mono', monospace;
            --card-border: #000000;
            --shadow: rgba(0, 0, 0, 0.1);
            --sidebar-bg: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-stack);
            font-size: 14px;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-user-select: none; 
            user-select: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Скроллбар */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }

        .hidden { display: none !important; }
        
        /* === ОКНО ВХОДА === */
        .login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.98);
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }

        .login-box {
            width: 420px; padding: 40px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            box-shadow: 0 0 40px var(--shadow);
            position: relative;
            max-width: 90%;
        }

        .login-title {
            text-align: center; margin-bottom: 30px;
            border-bottom: 1px solid var(--border); padding-bottom: 20px;
        }
        .login-title h1 { font-size: 32px; font-weight: 800; letter-spacing: 4px; color: var(--accent); margin: 0; }
        .login-title p { font-size: 10px; color: var(--text-dim); text-transform: uppercase; margin-top: 5px; letter-spacing: 2px; }

        .input-group { margin-bottom: 20px; }
        .input-group label {
            display: block; font-size: 11px; color: var(--text-dim);
            text-transform: uppercase; margin-bottom: 8px; font-weight: 700;
        }
        .input-group input {
            width: 100%; padding: 14px;
            background: var(--bg-input); border: 1px solid var(--border);
            color: var(--text-main); font-family: inherit; font-size: 14px;
            transition: 0.2s;
        }
        .input-group input:focus { outline: none; border-color: var(--accent); background: var(--bg-hover); }

        .btn-login {
            width: 100%; padding: 14px;
            background: var(--accent); color: var(--bg-body);
            border: none; font-weight: 800; text-transform: uppercase;
            cursor: pointer; transition: 0.3s; margin-top: 10px;
        }
        .btn-login:hover { opacity: 0.9; }

        .close-login { position: absolute; top: 15px; right: 20px; color: var(--text-dim); cursor: pointer; font-size: 18px; }
        .login-error { color: var(--danger); font-size: 12px; text-align: center; margin-top: 15px; min-height: 18px; font-weight: 700; }

        /* === ИНТЕРФЕЙС === */
        .app-layout { display: flex; min-height: 100vh; position: relative; }

        /* САЙДБАР */
        .sidebar {
            width: 320px; background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; flex-shrink: 0;
            transition: transform 0.3s ease;
            z-index: 100;
            position: relative;
        }

        .sidebar-header {
            height: 90px; display: flex; align-items: center; padding: 0 30px;
            border-bottom: 1px solid var(--border);
        }
        .sidebar-header h2 { font-size: 24px; font-weight: 800; letter-spacing: 2px; color: var(--accent); }

        .nav-area { flex: 1; padding: 30px; overflow-y: auto; }
        
        .nav-category {
            font-size: 10px; color: var(--text-muted); text-transform: uppercase;
            margin: 25px 0 10px 0; letter-spacing: 1px; font-weight: 700;
        }
        .nav-category:first-child { margin-top: 0; }

        .nav-btn {
            display: flex; align-items: center; gap: 12px;
            width: 100%; padding: 12px 0;
            background: transparent; border: none;
            color: var(--text-dim); text-align: left;
            cursor: pointer; font-family: inherit; font-size: 13px;
            transition: 0.2s;
            border-left: 2px solid transparent;
        }
        .nav-btn:hover { color: var(--accent); background: var(--bg-hover); }
        .nav-btn.active { color: var(--accent); font-weight: 700; border-left-color: var(--accent); }
        .nav-btn.active i { color: var(--accent); }
        .nav-btn i { width: 25px; text-align: center; font-size: 14px; color: var(--text-muted); transition: 0.2s; }

        .user-status {
            padding: 25px 30px; border-top: 1px solid var(--border);
            font-size: 11px; color: var(--text-dim); background: var(--bg-input);
        }

        /* Кнопка бургер-меню для мобильных */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 25px;
            left: 20px;
            z-index: 101;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: var(--text-main);
            width: 50px;
            height: 50px;
            border-radius: 4px;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 24px;
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
        }

        /* КОНТЕНТ */
        .content-area { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            width: 100%;
        }

        .top-bar {
            height: 90px; border-bottom: 1px solid var(--border);
            background: var(--bg-panel); display: flex; align-items: center;
            justify-content: space-between; padding: 0 50px; flex-shrink: 0;
            position: relative;
        }
        .page-title { font-size: 14px; font-weight: 700; text-transform: uppercase; color: var(--accent); letter-spacing: 1px; }

        .top-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: 0.3s;
        }

        .theme-toggle:hover {
            background: var(--bg-hover);
        }

        .auth-btn {
            border: 1px solid var(--border); background: transparent;
            color: var(--text-main); padding: 10px 24px;
            font-family: inherit; font-size: 12px; font-weight: 700;
            cursor: pointer; transition: 0.3s;
            border-radius: 4px;
        }
        .auth-btn:hover { background: var(--accent); color: var(--bg-body); }

        .scroll-container { 
            flex: 1; 
            overflow-y: auto; 
            padding: 60px 100px; 
            scroll-behavior: smooth;
            width: 100%;
        }

        /* === ТИПОГРАФИКА И ЭЛЕМЕНТЫ === */
        .section { display: none; max-width: 1200px; margin: 0 auto; padding-bottom: 100px; width: 100%; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }

        .section-header { 
            margin-bottom: 60px; 
            border-bottom: 1px solid var(--border); 
            padding-bottom: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-end;
            flex-wrap: wrap;
            gap: 20px;
        }
        .section-header h1 { 
            font-size: 36px; 
            font-weight: 800; 
            color: var(--accent); 
            margin-bottom: 10px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            line-height: 1.2;
        }
        .section-header p { 
            font-size: 13px; 
            color: var(--text-dim); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
        }

        .card {
            background: var(--bg-panel); 
            border: 1px solid var(--border);
            border-left: 4px solid var(--card-border);
            padding: 40px; 
            margin-bottom: 40px; 
            position: relative;
            box-shadow: 0 5px 15px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .card h3 {
            font-size: 20px; 
            color: var(--accent); 
            margin: 0 0 25px 0;
            text-transform: uppercase; 
            letter-spacing: 1px;
            display: flex; 
            align-items: center; 
            gap: 15px;
        }
        
        .card p { 
            margin-bottom: 15px; 
            text-align: justify; 
            color: var(--text-dim); 
            font-size: 14px; 
            line-height: 1.7;
        }
        .card strong { color: var(--accent); font-weight: 700; }

        /* Списки */
        .doc-list { list-style: none; margin-left: 0; margin-bottom: 20px; }
        .doc-list li { 
            position: relative; 
            padding-left: 20px; 
            margin-bottom: 10px; 
            color: var(--text-dim); 
            font-size: 14px; 
            line-height: 1.6;
        }
        .doc-list li::before { content: '>'; position: absolute; left: 0; color: var(--text-muted); font-weight: bold; }
        
        ol { margin-left: 20px; margin-bottom: 20px; color: var(--text-dim); }
        ol li { margin-bottom: 10px; padding-left: 10px; line-height: 1.6; }

        /* Таблица */
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 20px; overflow-x: auto; display: block; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid var(--border); color: var(--text-muted); text-transform: uppercase; font-size: 11px; }
        td { padding: 15px; border-bottom: 1px solid var(--border); color: var(--text-dim); }
        tr:hover td { background: var(--bg-hover); color: var(--text-main); }

        /* Кнопка */
        .recruit-btn {
            display: inline-flex; align-items: center; gap: 10px;
            padding: 16px 32px; background: var(--accent); color: var(--bg-body);
            text-decoration: none; font-weight: 800; text-transform: uppercase;
            margin-top: 30px; font-size: 13px; transition: 0.3s;
            border-radius: 4px;
        }
        .recruit-btn:hover { opacity: 0.9; }
        
        /* Сетка машин */
        .fleet-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }
        .car-card { 
            background: var(--bg-panel); 
            border: 1px solid var(--border); 
            padding: 25px; 
            transition: transform 0.3s ease;
        }
        .car-card:hover { transform: translateY(-3px); }
        .car-name { font-size: 16px; font-weight: 700; color: var(--accent); margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .car-details { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-dim); }

        /* Стили для вложенных списков */
        .doc-list ul { list-style: none; margin-left: 20px; margin-top: 10px; }
        .doc-list ul li { position: relative; padding-left: 15px; }
        .doc-list ul li::before { content: '-'; position: absolute; left: 0; color: var(--text-muted); }

        .sub-list { margin-left: 25px; margin-top: 10px; margin-bottom: 10px; }
        .sub-list li { list-style-type: circle; margin-bottom: 5px; color: var(--text-dim); }

        /* Кнопка реестра транспорта */
        .fleet-register-btn {
            display: inline-flex; align-items: center; gap: 10px;
            padding: 16px 32px; background: var(--accent); color: var(--bg-body);
            text-decoration: none; font-weight: 800; text-transform: uppercase;
            font-size: 13px; transition: 0.3s; margin-bottom: 20px;
            border-radius: 4px;
            white-space: nowrap;
        }
        .fleet-register-btn:hover { opacity: 0.9; }

        /* Стили для разделов документов */
        .subsection {
            margin-top: 30px;
            margin-bottom: 20px;
            border-left: 3px solid var(--text-muted);
            padding-left: 15px;
        }
        
        .subsection h4 {
            color: var(--text-main);
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .protocol-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--border);
        }
        
        .protocol-item:last-child {
            border-bottom: none;
        }

        /* === ЗАЩИТА ОТ СКРИНШОТОВ === */
        #screenshotShield {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 99999;
            pointer-events: none;
        }
        @media print {
            body * { visibility: hidden !important; }
            body::after {
                visibility: visible !important;
                content: 'НЕСАНКЦИОНИРОВАННЫЙ ДОСТУП ЗАПРЕЩЁН — MTF-7 SECURE DATABASE';
                position: fixed; top: 50%; left: 50%;
                transform: translate(-50%, -50%);
                font-size: 24px; color: #fff;
                background: #000; padding: 40px;
                font-family: monospace;
            }
        }

        /* === УВЕДОМЛЕНИЕ БЕЗОПАСНОСТИ (КОМПАКТНЫЙ ТОСТ) === */
        .sec-popup {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 300px;
            max-width: calc(100vw - 30px);
            background: var(--bg-panel);
            border: 1px solid var(--border);
            box-shadow: 0 4px 24px var(--shadow);
            z-index: 4000;
            animation: fadeIn 0.3s ease;
            user-select: none;
        }
        .sec-popup.hidden { display: none; }

        .sec-popup-drag {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 9px 14px;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
            cursor: grab;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }
        .sec-popup-drag:active { cursor: grabbing; }
        .sec-popup-drag-label { display: flex; align-items: center; gap: 7px; }
        .sec-popup-close {
            background: none; border: none;
            color: var(--text-muted); cursor: pointer;
            font-size: 13px; padding: 0; line-height: 1;
            transition: color 0.15s; flex-shrink: 0;
        }
        .sec-popup-close:hover { color: var(--accent); }

        .sec-popup-body {
            padding: 14px 14px 12px 14px;
        }
        .sec-popup-body p {
            font-size: 11px;
            color: var(--text-dim);
            line-height: 1.65;
            margin: 0 0 12px 0;
        }
        .sec-popup-body p:last-of-type { margin-bottom: 0; }
        .sec-popup-body p strong { color: var(--text-main); }

        .sec-popup-footer {
            display: flex;
            justify-content: flex-end;
            padding: 10px 14px 12px 14px;
            border-top: 1px solid var(--border);
        }
        .sec-popup-ok {
            padding: 7px 18px;
            background: var(--accent);
            color: var(--bg-body);
            border: none;
            font-family: inherit;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .sec-popup-ok:hover { opacity: 0.85; }

        /* === КНОПКА ОБНОВЛЕНИЯ В ТОПБАРЕ === */
        .reload-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            width: 40px; height: 40px;
            border-radius: 4px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 15px;
            transition: 0.2s;
        }
        .reload-btn:hover { color: var(--accent); background: var(--bg-hover); }
        .reload-btn.visible { display: flex; }

        /* === СОСТАВ: ЧИСТАЯ ТАБЛИЦА === */
        .roster-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            display: table;
        }
        .roster-table thead th {
            text-align: left;
            padding: 10px 14px;
            border-bottom: 2px solid var(--border);
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 1px;
            font-weight: 700;
        }
        .roster-table tbody tr {
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.12s;
        }
        .roster-table tbody tr:last-child { border-bottom: none; }
        .roster-table tbody tr:hover td { background: var(--bg-hover); }
        .roster-table tbody tr.row-commander td:first-child {
            border-left: 2px solid var(--warning);
        }
        .roster-table tbody tr.row-punished td:first-child {
            border-left: 2px solid var(--danger);
        }
        .roster-table td {
            padding: 13px 14px;
            color: var(--text-dim);
            vertical-align: middle;
        }
        .roster-td-callsign { color: var(--accent) !important; font-weight: 700; font-size: 14px; }
        .roster-td-rank     { font-size: 12px; }
        .roster-td-dept     { font-size: 11px; letter-spacing: 0.5px; }
        .roster-td-status.s-active   { color: var(--success) !important; }
        .roster-td-status.s-inactive { color: var(--danger) !important; }
        .roster-td-status.s-leave    { color: var(--warning) !important; }
        .roster-td-punish   { font-size: 11px; font-weight: 700; color: var(--danger) !important; }

        /* === МОДАЛ АГЕНТА === */
        .agent-modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 5000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        .agent-modal-overlay.open { display: flex; }
        .agent-modal {
            width: 480px;
            max-width: 90%;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-top: 3px solid var(--accent);
            box-shadow: 0 0 60px var(--shadow);
            animation: fadeIn 0.2s ease;
        }
        .agent-modal-header {
            padding: 28px 30px 20px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .agent-modal-name { font-size: 28px; font-weight: 800; color: var(--accent); letter-spacing: 2px; }
        .agent-modal-rank { font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-top: 4px; }
        .agent-modal-close {
            background: none; border: none; color: var(--text-muted);
            font-size: 20px; cursor: pointer; padding: 0; transition: 0.2s;
        }
        .agent-modal-close:hover { color: var(--accent); }
        .agent-modal-body { padding: 24px 30px; }
        .agent-modal-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed var(--border);
            font-size: 13px;
        }
        .agent-modal-row:last-child { border-bottom: none; }
        .agent-modal-row .row-label { color: var(--text-muted); text-transform: uppercase; font-size: 11px; letter-spacing: 1px; }
        .agent-modal-row .row-value { color: var(--text-main); font-weight: 700; text-align: right; }

        /* === МЕДИА-ЗАПРОСЫ ДЛЯ АДАПТИВНОСТИ === */
        
        /* Планшеты и маленькие ноутбуки */
        @media (max-width: 1200px) {
            .scroll-container {
                padding: 40px 60px;
            }
            
            .section-header h1 {
                font-size: 30px;
            }
            
            .card {
                padding: 30px;
            }
        }

        /* Планшеты */
        @media (max-width: 992px) {
            .sidebar {
                width: 280px;
            }
            
            .scroll-container {
                padding: 40px 50px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .section-header h1 {
                font-size: 28px;
            }
            
            .top-bar {
                padding: 0 30px;
            }
        }

        /* Телефоны */
        @media (max-width: 768px) {
            /* Бургер меню */
            .mobile-menu-btn {
                display: flex;
            }
            
            .mobile-overlay.active {
                display: block;
            }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                transform: translateX(-100%);
                z-index: 100;
                width: 280px;
                box-shadow: 5px 0 25px var(--shadow);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .app-layout {
                padding-left: 0;
            }
            
            /* Верхний бар */
            .top-bar {
                height: 70px;
                padding: 0 20px;
                justify-content: flex-end;
            }
            
            .page-title {
                font-size: 12px;
                position: absolute;
                left: 80px;
                top: 50%;
                transform: translateY(-50%);
                max-width: 150px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            .top-controls {
                gap: 10px;
            }
            
            .auth-btn {
                padding: 8px 16px;
                font-size: 11px;
            }
            
            .theme-toggle {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            /* Контент */
            .scroll-container {
                padding: 20px;
                padding-top: 90px;
            }
            
            .section-header {
                margin-bottom: 40px;
            }
            
            .section-header h1 {
                font-size: 24px;
            }
            
            .section-header p {
                font-size: 11px;
            }
            
            .card {
                padding: 25px 20px;
                margin-bottom: 30px;
            }
            
            .card h3 {
                font-size: 18px;
                margin-bottom: 20px;
            }
            
            .card p, .doc-list li, ol li {
                font-size: 13px;
            }
            
            /* Сетка машин */
            .fleet-grid {
                grid-template-columns: 1fr;
            }
            
            /* Кнопки */
            .recruit-btn, .fleet-register-btn {
                padding: 14px 24px;
                font-size: 12px;
                width: 100%;
                justify-content: center;
            }
            
            .fleet-register-btn {
                margin-top: 15px;
                margin-bottom: 0;
            }
            
            /* Окно входа */
            .login-box {
                padding: 30px 25px;
                width: 95%;
                max-width: 400px;
            }
            
            .login-title h1 {
                font-size: 28px;
            }
        }

        /* Маленькие телефоны */
        @media (max-width: 480px) {
            .top-bar {
                padding: 0 15px;
            }
            
            .page-title {
                left: 70px;
                max-width: 120px;
            }
            
            .scroll-container {
                padding: 15px;
                padding-top: 80px;
            }
            
            .section-header h1 {
                font-size: 22px;
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .card h3 {
                font-size: 16px;
            }
            
            .doc-list li {
                padding-left: 15px;
            }
            
            .doc-list li::before {
                left: -5px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 10px;
            }
        }

        /* Очень маленькие телефоны */
        @media (max-width: 360px) {
            .section-header h1 {
                font-size: 20px;
            }
            
            .card h3 {
                font-size: 15px;
            }
            
            .auth-btn {
                padding: 6px 12px;
                font-size: 10px;
            }
            
            .theme-toggle {
                width: 32px;
                height: 32px;
            }
        }
    </style>
</head>
<body>

    <div id="screenshotShield"></div>

    <!-- Уведомление безопасности -->
    <div class="sec-popup hidden" id="secPopup">
        <div class="sec-popup-drag" id="secPopupDrag">
            <span class="sec-popup-drag-label"><i class="fas fa-shield-alt"></i> Уведомление безопасности</span>
            <button class="sec-popup-close" onclick="closeSecPopup()"><i class="fas fa-times"></i></button>
        </div>
        <div class="sec-popup-body">
            <p>Активна <strong>система мониторинга</strong>. Съёмка экрана на закрытых страницах заблокирована.</p>
            <p>Распространение информации посторонним лицам <strong>запрещено</strong> и влечёт немедленное отстранение.</p>
        </div>
        <div class="sec-popup-footer">
            <button class="sec-popup-ok" onclick="closeSecPopup()">Принято</button>
        </div>
    </div>

    <!-- Модал агента -->
    <div class="agent-modal-overlay" id="agentModal" onclick="closeAgentModal(event)">
        <div class="agent-modal">
            <div class="agent-modal-header">
                <div>
                    <div class="agent-modal-name" id="modalCallsign"></div>
                    <div class="agent-modal-rank" id="modalRank"></div>
                </div>
                <button class="agent-modal-close" onclick="document.getElementById('agentModal').classList.remove('open')"><i class="fas fa-times"></i></button>
            </div>
            <div class="agent-modal-body" id="modalBody"></div>
        </div>
    </div>

    <div id="loginOverlay" class="login-overlay hidden">
        <div class="login-box">
            <i class="fas fa-times close-login" onclick="toggleLogin()"></i>
            <div class="login-title">
                <h1>MTF-7</h1>
                <p>SECURE ACCESS REQUIRED</p>
            </div>
            <div class="input-group">
                <label>Позывной</label>
                <input type="text" id="userInput" placeholder="Callsign" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Код доступа</label>
                <input type="password" id="passInput" placeholder="••••••••" autocomplete="off">
            </div>
            <div id="loginMsg" class="login-error"></div>
            <button class="btn-login" onclick="attemptLogin()">ВОЙТИ</button>
        </div>
    </div>

    <!-- Кнопка бургер-меню для мобильных -->
    <div id="mobileMenuBtn" class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
    </div>
    
    <!-- Оверлей для мобильного меню -->
    <div id="mobileOverlay" class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <div class="app-layout">
        
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>MTF-7 PORTAL</h2>
            </div>
            <div class="nav-area">
                <div class="nav-category">НАВИГАЦИЯ</div>
                <div id="navMenu">
                    <button onclick="switchTab('public'); closeMobileMenu();" class="nav-btn active">
                        <i class="fas fa-globe"></i> Общая информация
                    </button>
                    </div>
            </div>
            <div class="user-status" id="userDisplay">
                <i class="fas fa-user-shield"></i> &nbsp;ГОСТЕВОЙ РЕЖИМ
            </div>
        </aside>

        <main class="content-area">
            <div class="top-bar">
                <div class="page-title" id="pageTitle">ОБЩАЯ ИНФОРМАЦИЯ</div>
                <div class="top-controls">
                    <button id="reloadBtn" class="reload-btn" title="Обновить данные" onclick="softReload()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="themeToggle" class="theme-toggle" title="Сменить тему">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="auth-btn" onclick="toggleLogin()">
                        <i class="fas fa-lock"></i> АВТОРИЗАЦИЯ
                    </button>
                </div>
            </div>

            <div class="scroll-container">

                <section id="public" class="section active">
                    <div class="section-header">
                        <div>
                            <h1>Мобильная Опергруппа</h1>
                            <p>Официальный информационный ресурс MTF-7</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-shield-alt"></i> Информация о подразделении</h3>
                        <p>
                            Поздравляю тебя, гражданин! Ты находишься на официальном портале Группы тактического реагирования и расследований (MTF-7). Мы — организация, действующая согласно строгим внутренним регламентам и общепринятым правилам. Наша структура кардинально отличается от стандартных полицейских формирований.
                        </p>
                        <p>
                            Наша миссия: Устранение угроз высокой сложности, проведение специальных операций и расследований, где обычные методы неэффективны. Мы действуем скрытно, жестко и в рамках закона. В этом месте ошибок не прощают. Каждый сотрудник — это высококлассный специалист.
                        </p>

                        <div style="margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4 style="color: var(--accent); margin-bottom: 10px; text-transform: uppercase;">
                                    <i class="fas fa-crosshairs"></i> Tactical Response Team
                                </h4>
                                <p style="font-size: 13px;">
                                    Подразделение быстрого реагирования, выполняющее высокорисковые операции: задержания вооружённых лиц, штурмы, зачистки зданий, сопровождение спецопераций и пресечение непосредственных угроз. Контролирует действия преступных лиц, состоящих в мафиозных организациях и преступных группировках.
                                </p>
                            </div>
                            <div>
                                <h4 style="color: var(--accent); margin-bottom: 10px; text-transform: uppercase;">
                                    <i class="fas fa-search"></i> Criminal Investigation Department
                                </h4>
                                <p style="font-size: 13px;">
                                    Оперативно-следственный отдел, который занимается анализом преступной активности, сбором улик, допросами, подготовкой материалов и сопровождением дел, связанных с деятельностью MTF-7.
                                </p>
                            </div>
                        </div>

                        <a href="https://docs.google.com/forms/d/e/1FAIpQLScIXiYdfMpWtVCoy9aw-T-D_K-8laRPa7e8tv_unOZFeFGNdA/viewform" target="_blank" class="recruit-btn">
                            <i class="fas fa-file-contract"></i> ПОДАТЬ ЗАЯВЛЕНИЕ НА ВСТУПЛЕНИЕ
                        </a>
                    </div>

                    <div class="section-header" style="margin-top: 80px;">
                        <div>
                            <h1>Автопарк Подразделения</h1>
                            <p>Реестр служебного и личного транспорта</p>
                        </div>
                        <a id="fleetRegisterBtn" href="https://forms.gle/C2T91yRE9gXMJS9f8" target="_blank" class="fleet-register-btn hidden">
                            <i class="fas fa-car"></i> РЕЕСТР ТРАНСПОРТА
                        </a>
                    </div>
                    
                    <div id="fleetContainer" class="fleet-grid">
                        <div style="color: var(--text-dim); text-align: center; padding: 20px;">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка данных...
                        </div>
                    </div>
                </section>

                <!-- Дополнительные секции -->
                <section id="traineeSection" class="section">
                    <div class="section-header">
                        <h1><i class="fas fa-user-graduate"></i> Для стажера</h1>
                        <p>Материалы для прохождения стажировки</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-door-open"></i> Введение</h3>
                        <p>Поздравляю тебя, стажер! Ты - один из немногих, кто смог достичь то, что скрыто от глаз обычных людей и в частности обычных офицеров. Это Мобильная Опергруппа, если говорит сокращенно - MTF-7. Мы организация куда серьезнее, чем те, что вы видели ранее. Мы действуем согласно внутренним регламентам и общепринятым правилам МВД. Ваша первая задача - понять, что здесь ошибок не прощают, действовать здесь нужно максимально четко. Чтобы полноценно приступить к обязанностям младшего агента, а уже затем полностью осознать структуру всей организации, вы должны изучить темы, которые будут указаны ниже.</p>
                        
                        <p>После прохождения общей стажировки, вам придется выбрать подразделение. Далее вы начнете следующий этап обучения для работы по выбранному направлению. В будущем, вы сможете перейти в другое подразделение, но вам придется пройти новый курс обучения. Один и тот же агент сможет нести службу сразу в двух направлениях, если имеет 2 пройденных курса обучения и изъявит желание.</p>
                        
                        <h3><i class="fas fa-tasks"></i> Для успешной сдачи стажировки</h3>
                        <p>Для успешной сдачи стажировки, вам нужно знать первоначальную информацию:</p>
                        <ol class="doc-list">
                            <li>Структура MTF-7</li>
                            <li>Внутренний устав группы</li>
                            <li>Система наказания для агента</li>
                        </ol>
                    </div>
                </section>

                <section id="structureSection" class="section">
                    <div class="section-header">
                        <h1><i class="fas fa-sitemap"></i> Структура MTF-7</h1>
                        <p>Иерархия и подразделения организации</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-building"></i> Основная информация</h3>
                        <p>Мобильная опергруппа (MTF-7) является организацией, стремящейся различными методами устранить преступность и все ее источники. Организация состоит из высококвалифицированных агентов. Основная цель стажировки — подготовить вас к самостоятельной и командной работе в качестве агента MTF-7, оснастив вас необходимыми знаниями, навыками и умениями. В своем составе организация содержит различные подразделения, задачи которых для каждого разные.</p>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-crosshairs"></i> Tactical Response Team</h4>
                            <p>Подразделение быстрого реагирования, выполняющее высокорисковые операции: задержания вооружённых лиц, штурмы, зачистки зданий, сопровождение спецопераций и пресечение непосредственных угроз. Контролирует действия преступных лиц, состоящих в мафиозных организациях и преступных группировках.</p>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-search"></i> Criminal Investigation Department</h4>
                            <p>Оперативно-следственный отдел, который занимается анализом преступной активности, сбором улик, допросами, подготовкой материалов и сопровождением дел, связанных с деятельностью MTF-7.</p>
                        </div>
                        
                        <h3><i class="fas fa-list-ol"></i> Все должности организации</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Должность</th>
                                    <th>Обозначение</th>
                                    <th>Описание</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Commander</td>
                                    <td>C.MTF-7</td>
                                    <td>Высшее должностное лицо MTF-7, определяющее стратегию развития и утверждающее внутренние протоколы. Несет персональную ответственность за сохранение режима секретности и автономность подразделения. Единолично принимает решения о санкционировании спецопераций высшего риска и проведении кадровых чисток.</td>
                                </tr>
                                <tr>
                                    <td>Sub. Commander</td>
                                    <td>SUB.MTF-7</td>
                                    <td>Второе лицо в иерархии, осуществляющее оперативное управление личным составом и контроль дисциплины. Курирует работу подразделений, отвечает за проверку отчетности и квалификацию сотрудников. Обладает всей полнотой власти и правом принятия решений в отсутствие командира.</td>
                                </tr>
                                <tr>
                                    <td>Senior Agent</td>
                                    <td>S.MTF-7</td>
                                    <td>Элитный оперативник, выполняющий функции полевого командира во время штурмов и рейдов. Руководит тактическими группами, координирует действия на местах. Отвечает за обучение младшего состава. Выдает наказания агентам.</td>
                                </tr>
                                <tr>
                                    <td>Agent</td>
                                    <td>AG.MTF-7</td>
                                    <td>Основная боевая единица с полным допуском к информации и тайнам. В зависимости от специализации выполняет задачи по штурму укреплений или скрытому наблюдению. Обязан в совершенстве знать все внутренние уставы, протокола, инструкции реагирования и прочую информацию, связанную с группой.</td>
                                </tr>
                                <tr>
                                    <td>Junior Agent</td>
                                    <td>J.MTF-7</td>
                                    <td>Сотрудник, успешно прошедший Академию и получивший личный позывной, но находящийся на испытательном сроке. В этот период определяет свою специализацию для дальнейшей службы. Допускается к участию в операциях под надзором старших офицеров, выполняя задачи огневой поддержки.</td>
                                </tr>
                                <tr>
                                    <td>Trainee</td>
                                    <td>TR.MTF-7</td>
                                    <td>Кандидат, проходящий отбор в ряды MTF без доступа к секретным архивам и федеральной базе данных. Основная задача — изучение базовых деталей и подготовка к экзаменам. Запрещено участвовать в боевых операциях.</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3><i class="fas fa-users"></i> Руководство</h3>
                        <p>Руководство Мобильной опергруппы состоит из Командира и его Заместителя.</p>
                        <p><strong>Командир</strong> - высшее руководящее лицо Мобильной опергруппы, приказы которого должны строго выполняться всеми агентами без обсуждения. <strong>Заместитель Командира</strong> временно исполняет все обязанности Командира Мобильной опергруппы в случае отсутствия первого. Приказы Заместителя Командира также должны строго выполняться всеми агентами без обсуждения. Приказы руководства не должны переходить законную черту.</p>
                        
                        <h3><i class="fas fa-user-shield"></i> Полномочия Старшего Агента</h3>
                        <p>Во время проведения определенных специальных операций Старший Агент имеет право отдавать приказы должностям ниже во время отсутствия руководства или с его разрешения.</p>
                        
                        <h3><i class="fas fa-secret"></i> Секретность</h3>
                        <p>Каждый агент мобильной опергруппы должен хранить в тайне всю информацию о себе, а также всю информацию об отделе во избежание ее утечки в открытый доступ.</p>
                    </div>
                </section>

                <section id="charterSection" class="section">
                    <div class="section-header">
                        <h1><i class="fas fa-book"></i> Внутренний устав группы</h1>
                        <p>Нормативно-правовая база сотрудника</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-file-contract"></i> Раздел I. Общие положения</h3>
                        <ol>
                            <li>Устав для агентов MTF-7 - главный документ Мобильной опергруппы в котором отражены правила и обязанности всех агентов MTF-7. Нарушение данного устава недопустимо каждому агенту.</li>
                            <li>Мобильная оперативная группа является секретной организацией, цель которой - установление порядка во всем штате.</li>
                            <li>Мобильная опергруппа не является экстремистской организацией.</li>
                            <li>Мобильная опергруппа не предусматривает вмешательства в дела Министерства Обороны без необходимости.</li>
                            <li>Мобильная опергруппа не предусматривает применение силы или угрозы без необходимости.</li>
                            <li>Агентам мобильной опергруппы гарантируется анонимность со стороны высшего руководства.</li>
                            <li>Агентам мобильной опергруппы предоставляется медицинская помощь, убежище в случае крайней необходимости. Все затраты берет на себя руководство.</li>
                            <li>Все действия агентов мобильной опергруппы основываются на положениях данного устава.</li>
                            <li>Данный устав является дополнением основному уставу Министерства Внутренних Дел исключительно для агентов MTF-7. Придерживаться вы обязаны правилам и запретам как первого, так и второго.</li>
                            <li>Разглашение любой информации для Стажера или Агента строго настрого запрещено. За любую утечку информации, вы можете понести наказание, которое будет зависеть от важности той или иной информации.</li>
                        </ol>
                        
                        <h3><i class="fas fa-balance-scale"></i> Раздел II. Права и обязанности агентов</h3>
                        <ol>
                            <li>Агент обязуется носить при себе необходимый минимум снаряжения для выполнения своих прямых должностных обязанностей.</li>
                            <li>Агент обязан знать и соблюдать действующее законодательство и нормативно-правовые акты штата.</li>
                            <li>У всех агентов мобильной опергруппы имеются равные права. Никто из агентов не должен нарушать личные права своих коллег.</li>
                            <li>У агента есть право на приобретение имущества (Дом, Автомобиль, Бизнес и тд.).</li>
                            <li>У агента есть право на использование транспорта Мобильной опергруппы в установленных протоколом MTF-7 целях. Агент обязан следить за транспортом опергруппы, а также бережно относиться к нему.</li>
                            <li>Агент опергруппы имеет право на пользование оружием в установленных протоколом MTF-7 целях. Агент не имеет право на использование оружия в личных целях.</li>
                            <li>В обязанности агентов мобильной опергруппы входит:
                                <ul class="sub-list">
                                    <li>Контроль за выполнением законодательных актов</li>
                                    <li>Ликвидация различных форм преступлений</li>
                                    <li>Расследование секретных дел, недоступных для гражданских лиц</li>
                                    <li>Помощь Министерству Обороны штата, если на то имеется необходимость</li>
                                    <li>Проведение спецопераций в целях контроля за штатом</li>
                                    <li>Защита и сопровождения государственных лиц</li>
                                </ul>
                                Агент обязан соблюдать законы государства.
                            </li>
                        </ol>
                        
                        <h3><i class="fas fa-fist-raised"></i> Раздел III. Применение силы и оружия</h3>
                        <p>Всего существует пять стадий применения силы:</p>
                        <ul class="doc-list">
                            <li><strong>Первая стадия</strong> -- присутствие агента. При нахождении агента вызывается психологическое воздействие.</li>
                            <li><strong>Вторая стадия</strong> -- устные приказы, замечание. Случаются ситуации, что малейшего замечания хватает, для нужного давление для прекращения запрещенных деяний.</li>
                            <li><strong>Третья стадия</strong> -- применение физической силы, воздействий. Приемы рукопашного боя, заломы и так далее.</li>
                            <li><strong>Четвертая стадия</strong> -- использование спецсредств. К спецсредствам относятся: дубинка, наручники, тазер, газовая граната. Спецсредства используются, если подозреваемый оказывает сопротивление при аресте, выше вас ростом, больше массой. Электрошокер используется с целью обездвижения подозреваемого, в случае его наступления.</li>
                            <li><strong>Пятая стадия</strong> -- применение летального, огнестрельного оружия. Данная стадия применяется в случае прямой угрозы агенту или гражданскому лицу.</li>
                        </ul>
                        <ol>
                            <li>Агент имеет право на использование оружия в целях ликвидации преступного лица, если это предусмотрено законодательством штата и уставом МВД.</li>
                            <li>Агент имеет право сделать предупредительный выстрел в целях остановки преступника или преступных действий.</li>
                            <li>Агент обязан держать свое оружие в боевой готовности при различных ситуациях.</li>
                            <li>Агент имеет право открыть огонь на поражение в случае опасности для его жизни, жизни офицеров полиции или гражданских со стороны преступных лиц.</li>
                            <li>Агент имеет право на пользование оружия во время проведения различных спецопераций.</li>
                        </ol>
                        
                        <h3><i class="fas fa-calendar-alt"></i> Раздел IV. График работы</h3>
                        <ol>
                            <li>График работы:<br>
                                Будние дни: 09:00 - 22:00<br>
                                Суббота: 09:00 - 21:00<br>
                                Воскресенье выходной.
                            </li>
                            <li>Агент имеет право на отдых в течение одного часа раз в сутки с разрешения руководства.</li>
                            <li>Руководство имеет право обнулить выходной день агента в случае крайней необходимости. В данном случае руководство компенсирует потерю выходного денежными средствами, выделенные агенту.</li>
                            <li>При покидании мобильной опергруппы агент подписывает договор о неразглашении информации. В случае нарушения договора в отношении агента будут предусмотрены необходимые меры. Агент обязан предупредить руководство о покидании опергруппы.</li>
                        </ol>
                    </div>
                </section>

                <section id="punishmentSection" class="section">
                    <div class="section-header">
                        <h1><i class="fas fa-gavel"></i> Система наказаний для агентов</h1>
                        <p>Дисциплинарные меры и взыскания</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-exclamation-triangle"></i> Виды наказаний</h3>
                        <p>Существует 4 вида внутренних наказаний для агентов, получить которые они могут за нарушения различного типа.</p>
                        <ol>
                            <li>Беседа</li>
                            <li>Выговор</li>
                            <li>Понижение в должности</li>
                            <li>Исключение из рядов MTF-7</li>
                        </ol>
                        
                        <h3><i class="fas fa-user-times"></i> Основные нарушения</h3>
                        <p>Основные деяния, за которые агент может понести наказание:</p>
                        <p>Самое важное - намеренное разглашение информации лицам, которые не должны были этого знать. За это Вы можете понести самую сильную меру наказания. Другой же случай, если вы сделали это не намеренно. Эти обстоятельства могут быть учтены при выдаче Вам взыскания.</p>
                        <p>В других случаях, наказания выбираются по мере совершенных правонарушений, так что ваше поведение должно быть безупречным.</p>
                        
                        <h3><i class="fas fa-info-circle"></i> Примечание</h3>
                        <p>Данные наказания являются только для агентов и не имеют никакого отношения к общей системе наказания МВД, то есть, получая выговор, он не выйдет за пределы MTF. Понижение в должности не является понижением в звании в своем департаменте (если вы находились на должности агента в группе, и по какой то причине вас понижают в должности, то вместо агента вы становитесь младшим агентом).</p>
                    </div>
                </section>

                <section id="cidSection" class="section">
                    <div class="section-header">
                        <h1><i class="fas fa-search"></i> Протоколы CID</h1>
                        <p>Криминалистика и следственные мероприятия</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-project-diagram"></i> РАЗДЕЛ I. СТРУКТУРА, ПРОЦЕСС РАССЛЕДОВАНИЯ И РАБОТА НА МЕСТЕ ПРЕСТУПЛЕНИЯ</h3>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-book"></i> 1.1. Определение и цели</h4>
                            <p>Криминалистика --- это фундамент работы CID. Это наука о технических средствах и методах, применяемых для обнаружения, фиксации и использования доказательств. Система специальных знаний о технических средствах, тактических приемах и методах, применяемых для:</p>
                            <ul class="doc-list">
                                <li>Обнаружения (поиск скрытых улик)</li>
                                <li>Фиксации (процессуальное закрепление, чтобы улика имела силу в суде)</li>
                                <li>Изъятия (физическое сохранение)</li>
                                <li>Исследования (экспертиза)</li>
                            </ul>
                            <p>Ключевые объекты изучения:</p>
                            <ul class="doc-list">
                                <li>Преступная деятельность: Механизмы подготовки преступления, способы его совершения и методы сокрытия следов (уничтожение улик, инсценировки)</li>
                                <li>Криминалистическая деятельность: Работа следователей по сбору базы доказательств и экспертов по их анализу</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-tasks"></i> 1.2. Основные задачи сотрудника CID</h4>
                            <ul class="doc-list">
                                <li>Разработка и внедрение эффективных методов работы с доказательствами</li>
                                <li>Анализ ошибок, допущенных при производстве следственных действий, для их исключения в будущем</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-bullseye"></i> 1.3. Объекты изучения</h4>
                            <ul class="doc-list">
                                <li>Преступная деятельность</li>
                                <li>Криминалистическая деятельность (следствие, экспертиза, оперативно-розыскная деятельность)</li>
                            </ul>
                        </div>
                        
                        <h3><i class="fas fa-clipboard-list"></i> РАЗДЕЛ II. РЕГЛАМЕНТ РАССЛЕДОВАНИЯ</h3>
                        <p>Расследование состоит из 5 четко определенных этапов:</p>
                        <ol>
                            <li>Сбор улик и информации, опрос свидетелей</li>
                            <li>Разработка первичной версии</li>
                            <li>Составление кейс-файла</li>
                            <li>Поиск и задержание подозреваемого</li>
                            <li>Допрос</li>
                        </ol>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-lightbulb"></i> 2.1. Разработка первичной версии</h4>
                            <p>На данном этапе необходимо сделать выводы по имеющимся уликам и попытаться воссоздать картину произошедшего. Агентам дается полная свобода действий для того, чтобы они избрали наиболее эффективную тактику расследования. Разрешается взаимодействие с другими структурами.</p>
                            <p>Главной целью в построении первичной версии служит установление способа совершения преступления, его мотивов, сужение круга лиц, которые могут быть причастны к совершению преступления. Первичная версия зачастую оказывается неверной, однако может подтолкнуть агентов к истинной версии произошедшего.</p>
                            <p>Важно опираться именно на собранные улики, так как они дают более объективную информацию, нежели предположения или теории. Если улики недоступны, так как находятся на анализе, можно воспользоваться лишь их списком, но не делать выводов относительно причастных лиц. Это лучше сделать после завершения анализа.</p>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-folder-open"></i> 2.2. Составление Кейс-файла</h4>
                            <p>Кейс-файл --- материалы какого-либо дела. Они содержат в себе абсолютно всю информацию о текущем расследовании: улики, версии, протоколы и так далее. Для ускорения хода расследования и обеспечения оперативного взаимодействия агенты обязаны вносить в кейс-файл всю информацию, имеющуюся у них по данному расследованию. Один файл может содержать в себе информацию от нескольких агентов, участвующих в расследовании.</p>
                            <p>Каждый кейс-файл имеет определенный приоритет. Он показывает важность текущего расследования.</p>
                            <p>После закрытия дела кейс-файл подписывается специальным ZIP-кодом и отправляется в архив.</p>
                        </div>
                        
                        <h3><i class="fas fa-map-marker-alt"></i> РАЗДЕЛ III. РАБОТА НА МЕСТЕ ПРЕСТУПЛЕНИЯ</h3>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-search-location"></i> 3.1. Работа на месте преступления</h4>
                            <p>Сразу после прибытия на место преступления агенты должны начать сбор всевозможных улик, прямо или косвенно указывающих на подозреваемого. Стоит помнить, что чем раньше были собраны улики, тем больше информации можно получить. Некоторые виды улик имеют свойство стираться, высыхать или ещё каким-либо способом становиться непригодными для ведения следствия.</p>
                            <p>Основные улики, которые может обнаружить агент на месте преступления:</p>
                            <ul class="doc-list">
                                <li>Отпечатки пальцев</li>
                                <li>Следы резины, рисунки протектора автомобилей</li>
                                <li>Кровь</li>
                                <li>Пятна масла или бензина</li>
                                <li>Гильзы</li>
                                <li>Пули</li>
                                <li>Выброшенное неподалёку оружие и/или орудие преступления</li>
                                <li>Оставленные преступником бытовые предметы: салфетки, жвачка, газеты и так далее</li>
                                <li>Записи с камер видеонаблюдения. Сюда же относятся записи с видеорегистраторов в автомобилях</li>
                            </ul>
                            <p>Изъятые предметы помещаются в специальный герметичный контейнер. Жидкости стоит забирать вместе с материалом, на котором они находятся. Отпечатки пальцев собираются при помощи прозрачной ленты и переносятся на специальную карту. Все улики после сбора должны быть помещены в соответствующие условия, чтобы сохранить их пригодными для дальнейшего анализа сотрудниками ФБР.</p>
                            <p>Также стоит помнить про свидетелей. В отличие от улик человек может сообщить гораздо больше информации. Не обязательно проводить опрос на месте преступления: можно собрать контакты и спустя некоторое время вызвать свидетеля в офис. Важно письменно или на диктофон фиксировать всю информацию, полученную от свидетеля.</p>
                            <p>Не стоит всецело полагаться на показания свидетелей, так как в них большую роль играет человеческий фактор. Однако, зачастую в ходе опроса всплывают множество полезных сведений.</p>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-camera"></i> 3.2. Судебная фотография</h4>
                            <p>Фотосъемка выполняет функцию запечатления и исследования. Виды съемки:</p>
                            <ol>
                                <li>Ориентирующая: Снимается объект с привязкой к местности (ориентиру).
                                    <ul class="sub-list">
                                        <li>Круговая панорама: Съемка с одной точки вокруг оси. Минус: искажает расстояния, плохо для исследования</li>
                                        <li>Линейная панорама: Передвижение вместе с камерой вдоль объекта (например, длинного дома)</li>
                                    </ul>
                                </li>
                                <li>Обзорная: Объект с разных сторон, когда ориентирующей недостаточно</li>
                                <li>Узловая: Отображение следов с частью прилегающей территории (пример: взломанная дверь целиком)</li>
                                <li>Детальная: Макросъемка самих следов</li>
                            </ol>
                        </div>
                        
                        <h3><i class="fas fa-shoe-prints"></i> РАЗДЕЛ IV. ТРАСОЛОГИЯ</h3>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-cube"></i> 4.1. Фундаментальные понятия</h4>
                            <p>След --- это любое материальное изменение обстановки. В трасологии под "следом" понимают как отпечаток (узкий смысл), так и последствия действий (широкий смысл --- например, разбросанные вещи).</p>
                            <p>Классификация следов:</p>
                            <ul class="doc-list">
                                <li>Материальные: Физическое отображение одного объекта на другом (отпечаток обуви, след взлома)</li>
                                <li>Идеальные: Мысленный образ, сохранившийся в памяти свидетеля</li>
                                <li>Виртуальные: Цифровые следы (IP-адреса, логи серверов, биллинг звонков)</li>
                                <li>Биологические: Следы рук (потожировые), кровь, слюна</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-fingerprint"></i> 4.2. Принципы идентификации</h4>
                            <p>Трасология базируется на том, что каждый объект индивидуален благодаря микрорельефу.</p>
                            <ul class="doc-list">
                                <li>Идентификация целого по частям: Критически важна при ДТП и взрывах.
                                    <ul class="sub-list">
                                        <li>Пример: На месте наезда найдены осколки фары. У подозреваемого разбита фара. Если линия разлома совпадает --- это 100% доказательство. Это возможно только если есть общая линия разделения (разлом, разрез, разрыв).</li>
                                    </ul>
                                </li>
                                <li>Индивидуальность микрорельефа:
                                    <ul class="sub-list">
                                        <li>Любой инструмент оставляет уникальные царапины</li>
                                        <li>Проблема износа: Объект меняется со временем. Пуля, выпущенная из ствола первым выстрелом, и пуля от 1000-го выстрела будут иметь разные следы, так как ствол "стачивается". Идентификация возможна только в пределах определенного временного периода</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        
                        <h3><i class="fas fa-unlock-alt"></i> РАЗДЕЛ V. ТЕХНИКО-КРИМИНАЛИСТИЧЕСКОЕ ИССЛЕДОВАНИЕ ВЗЛОМА</h3>
                        <p>Агент должен уметь определить квалификацию взломщика (профессионал или любитель) по типу оставленных следов и способу вскрытия.</p>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-key"></i> 5.1. Классификация замков</h4>
                            <p>Понимание конструкции замка позволяет сузить круг подозреваемых (инструмент подбирается под замок).</p>
                            <p>1. По способу крепления:</p>
                            <ul class="doc-list">
                                <li>Навесные (Амбарные): Самые примитивные</li>
                                <li>Накладные: Корпус не входит в тело двери (часто в старых дверях или мебели)</li>
                                <li>Врезные: Корпус полностью скрыт в двери</li>
                            </ul>
                            <p>2. По механизму:</p>
                            <ul class="doc-list">
                                <li>Цилиндровые: Самые распространенные. Уязвимое место --- личинка</li>
                                <li>Сувальдные: "Сейфовые" замки</li>
                                <li>Дисковые: Взламываются часто "свертышем" (инструмент из прочной стали)</li>
                                <li>Реечные: Примитивные, открываются даже подручными средствами (веткой, струной)</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-tools"></i> 5.2. Методы взлома и противодействие</h4>
                            <p>Следы на месте преступления указывают на метод:</p>
                            <p>1. Силовой:</p>
                            <ul class="doc-list">
                                <li>Высверливание: След остается в нижней части цилиндра</li>
                                <li>Химический/Термический: Жидкий азот (заморозка и удар) или кислота</li>
                                <li>Свёртыш: Использование заготовки из сверхпрочной стали для срезания штифтов поворотом</li>
                            </ul>
                            <p>2. Интеллектуальный:</p>
                            <ul class="doc-list">
                                <li>Использование отмычек, бампинг, подбор ключа</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-search-plus"></i> 5.3. Следы взлома на преградах</h4>
                            <ol>
                                <li>Следы давления: Вмятины. Образуются при использовании лома/фомки как рычага (отжим двери)</li>
                                <li>Следы скольжения (трения): Царапины. Возникают, когда инструмент соскальзывает или просовывается (например, нож для скидывания крючка)</li>
                                <li>Следы разреза/распила:
                                    <ul class="sub-list">
                                        <li>Простой разрез: Орудие с одной кромкой (топор, стамеска)</li>
                                        <li>Встречный разрез: Орудие с двумя кромками (кусачки, ножницы по металлу)</li>
                                        <li>Сверление: Характерная стружка. Перовое сверло оставляет отверстия большого диаметра</li>
                                    </ul>
                                </li>
                                <li>Специфические методы проникновения через окна:
                                    <ul class="sub-list">
                                        <li>Использование "пластыря" (ткань с липким веществом --- мед/солидол) для бесшумного разбития стекла. Звук глушится, осколки остаются на ткани</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        
                        <h3><i class="fas fa-bullseye"></i> РАЗДЕЛ VI. СУДЕБНАЯ БАЛЛИСТИКА</h3>
                        <p>Критически важный раздел для расследования перестрелок. Баллистика позволяет связать пулю, гильзу и ствол.</p>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-gun"></i> 6.1. Классификация огнестрельного оружия</h4>
                            <p>Оружие признается огнестрельным при наличии 4 признаков: ствол, взрывчатое вещество, устройство воспламенения и достаточное поражающее действие.</p>
                            <p>Типология:</p>
                            <p>1. По назначению:</p>
                            <ul class="doc-list">
                                <li>Боевое/Служебное: Полицейское и армейское вооружение</li>
                                <li>Гражданское: Оружие самообороны</li>
                                <li>Криминальное: Кустарное производство (самоделы, обрезы, переделки). Характеризуется нестабильными характеристиками и низким качеством</li>
                            </ul>
                            <p>2. По каналу ствола:</p>
                            <ul class="doc-list">
                                <li>Гладкоствольное: Ровные стенки. Может иметь сужения</li>
                                <li>Нарезное: Имеет винтовые нарезы (обычно 4 и более) для стабилизации пули</li>
                                <li>Полигональное: Ствол в форме правильного многоугольника (редкость, пример G-11)</li>
                            </ul>
                            <p>3. По автоматизации:</p>
                            <ul class="doc-list">
                                <li>Автоматическое: Стреляет очередями, пока нажат спуск</li>
                                <li>Полуавтоматическое (Самозарядное): Один выстрел --- одно нажатие (большинство пистолетов, Glock, Desert Eagle)</li>
                                <li>Неавтоматическое: Требует ручной перезарядки после каждого выстрела (болтовые винтовки, помповые дробовики)</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-microscope"></i> 6.2. Следообразование</h4>
                            <p>Каждый ствол оставляет уникальный "отпечаток" на боеприпасах.</p>
                            <p>1. Следы на ГИЛЬЗЕ: Наиболее информативны для экспертизы</p>
                            <ul class="doc-list">
                                <li>След бойка: Вмятина на капсюле (в центре или с краю)</li>
                                <li>След патронного упора: Отпечаток на донышке гильзы в момент выстрела (из-за давления газов)</li>
                                <li>След выбрасывателя: Царапины на закраине гильзы при извлечении</li>
                                <li>След отражателя: Вмятина на донышке при вылете гильзы из окна затвора</li>
                            </ul>
                            <p>2. Следы на ПУЛЕ:</p>
                            <ul class="doc-list">
                                <li>Первичные: Царапины от микрорельефа ствола до входа в нарезы</li>
                                <li>Вторичные: Следы от самих нарезов. Обычно перекрывают первичные. По ним определяют модель оружия</li>
                            </ul>
                            <p>3. Следы ДРОБИ: На дробинах могут оставаться следы от соседних дробин (контактные пятна) и следы от канала ствола (на крайних дробинах). Теоретически позволяют определить калибр.</p>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-vest"></i> 6.3. Работа с оружием на месте преступления</h4>
                            <ol>
                                <li>Фиксация: Сначала фотосъемка и схема, только потом --- касание</li>
                                <li>Изъятие: Брать только в перчатках за места, где наименее вероятны отпечатки (рифленые накладки рукояти). За спусковую скобу брать не рекомендуется, там могут быть следы</li>
                                <li>Проверка: Определить, взведен ли курок</li>
                                <li>Разрядка: Если оружие заряжено --- разрядить в штатном режиме. Если затвор заклинило --- вставить мягкую прокладку между курком и бойком, чтобы исключить случайный выстрел при транспортировке</li>
                                <li>Консервация: Чистить ствол НЕЛЬЗЯ. Дульный срез закрывается колпачком (бумага/ткань) для сохранения нагара и микрочастиц</li>
                            </ol>
                        </div>
                        
                        <div class="subsection">
                            <h4><i class="fas fa-ruler-combined"></i> 6.4. Определение траектории</h4>
                            <p>Методы установления места стрелка:</p>
                            <ol>
                                <li>Бумажная трубка: Прикладывается к пулевому отверстию (на малых дистанциях)</li>
                                <li>Нить: Натягивается от пробоины</li>
                                <li>Лазер: Современный метод. Важно учитывать рикошеты и деформацию пули</li>
                            </ol>
                        </div>
                        
                        <h3><i class="fas fa-pen-fancy"></i> РАЗДЕЛ VII. ПОЧЕРКОВЕДЕНИЕ</h3>
                        <p>Используется для анализа записок с угрозами, предсмертных записок и поддельных документов.</p>
                        <p>Основные принципы:</p>
                        <ol>
                            <li>Индивидуальность: Почерк уникален. Формируется под влиянием:
                                <ul class="sub-list">
                                    <li>Объективных факторов: Условия обучения, освещение, парта</li>
                                    <li>Субъективных факторов: Анатомия кисти, зрение, состояние мышц</li>
                                </ul>
                            </li>
                            <li>Динамическая устойчивость: Почерк сохраняет свои признаки во времени, но может меняться из-за:
                                <ul class="sub-list">
                                    <li>Возраста (старческий почерк)</li>
                                    <li>Практики (чем больше пишешь, тем автоматизированнее навык)</li>
                                </ul>
                            </li>
                            <li>Избирательная изменчивость: Изменение почерк под влиянием стресса, алкоголя, неудобной позы или намеренного искажения. Задача эксперта --- отличить намеренное искажение от естественного</li>
                        </ol>
                    </div>
                </section>

                <section id="trtSection" class="section">
                    <div class="section-header">
                        <h1><i class="fas fa-crosshairs"></i> Протоколы TRT</h1>
                        <p>Тактика ведения боя и штурма</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-car-crash"></i> Протоколы TRT</h3>
                        
                        <div class="protocol-item">
                            <h4><i class="fas fa-exclamation-circle"></i> 1. 10-66</h4>
                            <p>Трафик-стоп повышенного риска. Осуществляется по причинам:</p>
                            <ol>
                                <li>Если водитель не выполняет требования агента</li>
                                <li>Если есть угроза применения оружия со стороны водителя</li>
                                <li>Если водитель данного транспортного средства находится в федеральном розыске</li>
                            </ol>
                            <p>Действия сотрудников:</p>
                            <ol>
                                <li>Немедленно сообщить в рацию</li>
                                <li>Вызвать юнитов на 10-66</li>
                                <li>По приезду юнитов, кто-то должен взять все под свой контроль</li>
                                <li>Заставить водителя выйти из автомобиля, и поднять руки вверх</li>
                            </ol>
                            <p>Если водитель выполнил требования, то можно смело проводить его арест:</p>
                            <ol>
                                <li>Заставить выйти из т/с под прицелом оружия</li>
                                <li>Скрутить подозреваемого</li>
                                <li>Надеть на него наручники, после чего посадить на заднее сиденье служебного автомобиля</li>
                                <li>Доставить в ближайший участок</li>
                            </ol>
                            <p>Если водитель открыл огонь, то обязательно нужно открыть ответный огонь на поражение.</p>
                        </div>
                        
                        <div class="protocol-item">
                            <h4><i class="fas fa-handcuffs"></i> 2. Арест преступных лиц [Без агрессии со стороны преступника]</h4>
                            <p>Для задержания и последующего ареста подозреваемого у агентов обязательно должно быть транспортное средство [Т/с опергруппы или полиции].</p>
                            <p>Во время всего мероприятия у агентов должна быть маска на лице.</p>
                            <p>Агент не должен снимать маску ни по какому требованию преступных лиц.</p>
                            <p>Останавливаете транспортное средство. Представляетесь, требуете документы или пробиваете подозреваемого по КПК (если подозреваемый не в маске), далее передаете ордер на арест, говоря, что тот находится в федеральном розыске.</p>
                            <p>После чего надеваете на подозреваемого наручники и садите в автомобиль. При попытке бегства - розыск по У.К. 9.3.</p>
                            <p>Агент обязан зачитать правило "Миранды".</p>
                            <p>Если подозреваемый не садится в автомобиль - ликвидация по У.К. 9.3. Если подозреваемый в розыске, но он находится в маске, то останавливаете только если было замечено нарушение У.К./А.К. (5.2 А.К. не в счет).</p>
                            <p>Вы - агенты организации, недоступной для обычных людей, поэтому старайтесь исключить лишние разговоры перед подозреваемыми.</p>
                        </div>
                        
                        <div class="protocol-item">
                            <h4><i class="fas fa-skull-crossbones"></i> 3. Ликвидация преступных лиц [Агрессия со стороны преступника]</h4>
                            <p>Процесс задержания тот же, что и во втором пункте этого раздела.</p>
                            <p>В случае, если подозреваемый имеет при себе оружие - приказываете бросить его на землю, если ваши требования игнорируют - объявляйте в розыск по У.К. 9.1.</p>
                            <p>Поскольку ликвидация по 9.1 У.К. с недавнего времени запрещена, пытайтесь вести переговоры с подозреваемым. Если он отказывается взаимодействовать, можете использовать спец. технику департамента, сбивать его с ног (это делать разрешено правилами сервера, если на то есть причина).</p>
                            <p>В случае попытки открыть огонь или в случае открытия огня со стороны подозреваемого - ликвидируйте на месте по У.К. 2.2.</p>
                        </div>
                        
                        <div class="protocol-item">
                            <h4><i class="fas fa-user-shield"></i> 4. Сопровождение и охрана государственных лиц</h4>
                            <p>У агентов обязана быть маска на лице во время кортежа и охраны. Маску не снимать ни при каких обстоятельствах, будь то требование гражданских или же государственных лиц.</p>
                            <p>Докладывайте об охране в рацию департамента. Разговоры во время кортежа или охраны исключить.</p>
                            <p>Переговоры только между агентами и только на волне рации департамента. Кортеж осуществляется на транспортных средствах группы или полиции.</p>
                        </div>
                        
                        <div class="protocol-item">
                            <h4><i class="fas fa-folder-secret"></i> 5. Раскрытие дел, недоступных для гражданских лиц и лиц гос. организаций</h4>
                            <p>После того, как появилось дело, на него отправляются агенты мобильной опергруппы.</p>
                            <p>Часть агентов является группой зачистки, вторая - группой расследования.</p>
                            <p>Группа зачистки обязана убрать всех государственных лиц и гражданских лиц, являющихся свидетелями, с территории. Помните, что вы не должны выдавать любую информацию, касающуюся группы тактического реагирования.</p>
                            <p>Прикажите им, чтобы они покинули территорию, большего не надо. Не забывайте оцепить территорию. В случае игнорирования - арест по У.К. 10.1.</p>
                            <p>У каждого агента (группа зачистки, группа расследования) обязана быть маска. Группа расследования в свою очередь раскрывает дело (RP отыгровки).</p>
                            <p>В случае, если территория обследована и можно ее покидать - убираете ограждения и покидаете территорию, не забывая про то, что никакую информацию вы не выдаете. Любая утечка может привести к серьезным последствиям.</p>
                        </div>
                        
                        <div class="protocol-item">
                            <h4><i class="fas fa-door-closed"></i> 6. Ведение штурма</h4>
                            <p>Штурм - одно из средств агентов мобильной опергруппы, предназначенное для урегулирования ситуации. Штурм применяется при освобождении заложника, уничтожении преступных группировок и в прочих подобных ситуациях.</p>
                            <p>При штурме помещений с заложником или при захвате вооруженного преступника возможно применение следующего тактического способа:</p>
                            <ul class="doc-list">
                                <li>Головной агент (самый первый), имеющий при себе дробовик, отстреливает замок и петли, далее выносит дверь и отходит в сторону для того, чтобы остальные агенты могли зайти на объект. Головной агент, после того как все зашли внутрь, заходит в здание самым последним</li>
                                <li>Первый агент, который зашел в здание, быстро осматривает помещение, в случае обнаружения враждебной цели - ликвидирует ее</li>
                                <li>Второй агент, зашедший в здание после первого, двигается в противоположном направлении от первого, действуя также как предыдущий - при обнаружении враждебной цели идет ликвидация</li>
                                <li>Агенты, идущие после первого и второго агентов, могут помочь первым при перестрелке. Если никого не было обнаружено, то первые два агента сообщают остальным о том, что можно двигаться дальше путем подачи команд</li>
                                <li>Головной агент прикрывает своих товарищей со спины. Весь штурм должен также сопровождаться подачей команд на волне рации между агентами MTF-7</li>
                            </ul>
                            <p>Углы:</p>
                            <p>Лидер приближается к углу вместе со своим прикрывающим. Прикрывающий должен обеспечить безопасность им обоим.</p>
                            <p>Лидер имеет более низкую стойку, оставляя тем самым достаточного пространства для ведения огня от прикрывающего.</p>
                            <p>Прикрывающий передвигается вплотную к лидеру, непосредственно сзади него.</p>
                            <p>Неприятельские цели различаются по степени представляемой угрозы. На это оказывают влияние следующие факторы:</p>
                            <ul class="doc-list">
                                <li>близость нахождения</li>
                                <li>степень вооруженности</li>
                                <li>производимые действия</li>
                                <li>местонахождение заложников</li>
                            </ul>
                        </div>

                        <div class="protocol-item">
                            <h4><i class="fas fa-shield-alt"></i> 7. Иерархия безопасности и приоритеты</h4>
                            <p>Каждый агент мобильной опергруппы при принятии тактических решений обязан руководствоваться строгой иерархией сохранения жизни. Это не рекомендация — это обязательный оперативный стандарт. Нарушение иерархии в поле приравнивается к провалу операции и влечет служебное расследование.</p>
                            <p>Решения принимаются в следующем порядке значимости:</p>
                            <ol>
                                <li><strong>Заложники и гражданские лица внутри периметра</strong> — высший приоритет. Любое тактическое решение принимается с учетом их местонахождения. Если гражданский находится под непосредственной угрозой — агент обязан вступить в контакт с целью немедленно, даже в одиночку, не ожидая подкрепления. Промедление, вызванное страхом или нерешительностью, является нарушением протокола.</li>
                                <li><strong>Личный состав группы</strong> — второй приоритет. Агент не является расходным материалом. Если гражданским не угрожает гибель в ближайшие секунды — агент не должен занимать позицию под открытым огнем без укрытия, преследовать вооруженного в одиночку или входить в неизвестное помещение без поддержки. Раненый агент парализует группу: требует эвакуации, тратит ресурсы, нарушает построение.</li>
                                <li><strong>Гражданские вне зоны периметра</strong> — третий приоритет. Каждый агент несет личную ответственность за контроль сектора обстрела. Перед открытием огня агент обязан визуально убедиться, что траектория пули не ведет за периметр оцепления. Огонь через стены, двери и в направлении скопления людей без четкой идентификации цели — запрещен.</li>
                                <li><strong>Подозреваемый (Цель)</strong> — низший приоритет. Жизнь цели не является тактической ценностью, если она угрожает перечисленным выше категориям. При этом ликвидация цели не является самоцелью: если цель обезоружена или утратила возможность угрожать — применение летальной силы прекращается.</li>
                            </ol>

                            <div class="subsection">
                                <h4><i class="fas fa-exclamation-circle"></i> 7.1. Принцип "не создавай вторую жертву"</h4>
                                <p>Агент, бросившийся спасать заложника без оценки обстановки, рискует стать второй жертвой и полностью дестабилизировать группу. Перед любым сближением с целью агент обязан ответить на три вопроса: <strong>где цель, где заложник, где моя поддержка</strong>. Если хотя бы один ответ неизвестен — агент удерживает позицию и запрашивает группу. Эмоциональные решения в поле убивают быстрее, чем пуля противника.</p>
                            </div>

                            <div class="subsection">
                                <h4><i class="fas fa-broadcast-tower"></i> 7.2. Доклад о статусе</h4>
                                <p>В ходе операции каждый агент обязан кратко докладывать командиру при любом изменении обстановки: обнаружение новой цели, смена позиции, ранение, исчерпание боеприпасов, обнаружение гражданских. Командир на основании докладов корректирует тактику. Молчание в эфире при активной угрозе интерпретируется как нештатная ситуация — группа обязана проверить агента.</p>
                                <p>Стандарт доклада: <strong>[Позывной] — [локация] — [статус / угроза]</strong>. Пример: "Альфа, угол здания — вижу цель, пистолет, движется к выходу". Не более двух предложений. Лишние слова в эфире создают шум и отвлекают.</p>
                            </div>
                        </div>

                        <div class="protocol-item">
                            <h4><i class="fas fa-crosshairs"></i> 8. Классификация угроз и регламент реагирования</h4>
                            <p>Тактика группы (немедленный штурм, оцепление или кризисные переговоры) определяется исключительно статусом цели на момент прибытия. Командир группы обязан классифицировать угрозу в течение первых 60 секунд и объявить протокол в эфире. Смена протокола также объявляется вслух — самостоятельная переоценка ситуации агентом без команды запрещена.</p>

                            <div class="subsection">
                                <h4><i class="fas fa-running"></i> ПРОТОКОЛ I — "Немедленное вмешательство" (Активный стрелок)</h4>
                                <p><strong>Признаки:</strong> звуки выстрелов, визуально подтвержденные жертвы, цель активно перемещается и ведет огонь.</p>
                                <p>Группа не ожидает полного сбора состава — входят немедленно. Нет переговоров, нет предупреждений, нет выдвижения ультиматумов. Каждая секунда промедления означает новых жертв.</p>
                                <p><strong>Порядок действий:</strong></p>
                                <ol>
                                    <li>Командир объявляет в эфире: "Протокол Один, активный стрелок, вход немедленно".</li>
                                    <li>Группа формирует контактную колонну: минимум двое, оружие готово, движение к последнему известному положению цели.</li>
                                    <li>Агенты двигаются на звук. Если стрельба прекратилась — не расслабляться: цель могла перезарядиться, затаиться или взять заложника.</li>
                                    <li>При обнаружении цели — немедленно объявить "Стоп, не двигаться, бросить оружие". Если команда игнорируется или цель поднимает ствол — огонь на поражение без паузы.</li>
                                    <li>Раненых гражданских не трогать до нейтрализации угрозы: оказание помощи под огнем создает неподвижную мишень из агента.</li>
                                </ol>
                                <p><strong>Критический момент:</strong> не путать активного стрелка с паникующим вооруженным гражданином. Если лицо удерживает оружие, не стреляет и кричит — это уже ситуация забаррикадировавшегося. Командир обязан переоценить статус.</p>
                            </div>

                            <div class="subsection">
                                <h4><i class="fas fa-lock"></i> ПРОТОКОЛ II — "Оцепление и сдерживание" (Забаррикадировавшийся)</h4>
                                <p><strong>Признаки:</strong> вооруженная цель закрылась в помещении, не ведет активного огня, отказывается выходить, не удерживает заложников.</p>
                                <p>Ключевой принцип: <strong>время работает на нас</strong>. Голодный, уставший, нервирующийся человек рано или поздно примет неверное решение. Задача агентов — не дать ему сбежать и не создать повода для начала стрельбы.</p>
                                <p><strong>Порядок действий:</strong></p>
                                <ol>
                                    <li>Установить внешний периметр: перекрыть все пути отхода — выходы, окна, подвальные люки. Каждый агент держит свой сектор и не оставляет позицию без команды.</li>
                                    <li>Исключить контакт гражданских с зоной: всех посторонних лиц удалить за периметр. Зеваки и гражданские вблизи окон — потенциальные жертвы и помехи для работы группы.</li>
                                    <li>Установить голосовой контакт. Командир или назначенный агент начинает словесный контакт через дверь или с безопасного угла: спокойный, уверенный тон, без угроз, без эмоций. Цель диалога — узнать состояние цели, наличие оружия и возможных раненых.</li>
                                    <li>Никто не подходит к двери вплотную. Позиция для голосового контакта — за углом стены или за укрытием с возможностью немедленного отхода.</li>
                                    <li>Командир принимает решение о штурме только если: цель начала стрелять через дверь или стену, обнаружены жертвы внутри, или цель объявила о самоуничтожении.</li>
                                </ol>
                                <p><strong>Запрещено:</strong> агентам запрещено самостоятельно выдвигаться к двери, угрожать в эфире ("мы войдем и убьем тебя"), создавать шум или провокации, а также покидать позицию без смены.</p>
                            </div>

                            <div class="subsection">
                                <h4><i class="fas fa-user-shield"></i> ПРОТОКОЛ III — "Кризисный вход" (Захватчик заложника)</h4>
                                <p><strong>Признаки:</strong> цель удерживает одного или нескольких человек, использует их как живой щит или инструмент давления.</p>
                                <p>Это наиболее сложный сценарий. Приоритет — жизнь заложника. Штурм рассматривается как крайняя мера. Неправильно выбранный момент входа убивает заложника, а не спасает его.</p>
                                <p><strong>Порядок действий:</strong></p>
                                <ol>
                                    <li>Командир немедленно назначает ведущего переговорщика из состава группы — одного агента, который говорит. Остальные агенты молчат в эфире и удерживают периметр.</li>
                                    <li>Переговорщик устанавливает голосовой контакт. Задачи: выяснить количество заложников и их состояние, требования цели, оружие цели, эмоциональный статус. Каждое полученное слово — информация для командира.</li>
                                    <li>Командир удерживает группу в готовности к немедленному входу, но без движения. Позиции — у всех возможных точек входа одновременно, если позволяет состав группы.</li>
                                    <li><strong>Критерии немедленного штурма без команды:</strong> агент визуально наблюдает, что цель производит действия, угрожающие жизни заложника (поднимает оружие к голове, начинает физическое насилие). В этом случае — вход немедленно, доклад после.</li>
                                    <li>При штурме: первый агент нейтрализует цель, второй немедленно закрывает заложника собой или выводит его из зоны огня. Заложник не должен оставаться стоять рядом с нейтрализованной целью.</li>
                                    <li>После нейтрализации цели и обеспечения безопасности заложника — полный осмотр помещения. Цель могла иметь сообщника или второй выход.</li>
                                </ol>
                                <p><strong>Психологический фактор:</strong> захватчик заложника, как правило, находится в состоянии крайнего стресса. Резкие звуки, крики, агрессивный тон переговорщика могут спровоцировать импульсивный выстрел. Голос всегда ровный, темп речи медленный, требования — конкретные и выполнимые.</p>
                            </div>
                        </div>

                        <div class="protocol-item">
                            <h4><i class="fas fa-exclamation-triangle"></i> 9. Основания для открытия огня на поражение</h4>
                            <p>Применение летальной силы — это крайняя и невозобновляемая мера. Каждый выстрел агента должен быть обоснован. Агент, применивший оружие без соблюдения настоящего регламента, несет полную служебную и правовую ответственность вне зависимости от исхода операции.</p>
                            <p>Огонь открывается только при одновременном совпадении всех трёх факторов <strong>"Треугольника угрозы"</strong>:</p>
                            <ol>
                                <li><strong>Средство (Ability)</strong> — у цели визуально подтверждено наличие: огнестрельного оружия, холодного оружия на дистанции ближнего боя, предмета, используемого как оружие (арматура, бита, бутылка), либо транспортного средства, направленного на агента или гражданских. Вербальная угроза без средства — не является основанием.</li>
                                <li><strong>Возможность (Opportunity)</strong> — цель находится на дистанции или в позиции, при которой способна эффективно применить своё средство. Вооруженный человек за закрытой дверью — не имеет прямой возможности. Вооруженный человек на дистанции 5 метров, без преграды между ним и агентом — имеет.</li>
                                <li><strong>Намерение (Intent)</strong> — поведение цели явно свидетельствует о готовности немедленно применить оружие: направляет ствол, не реагирует на команду "Стоп / Бросить оружие" и продолжает движение, занимает изготовку для выстрела, производит атаку.</li>
                            </ol>

                            <div class="subsection">
                                <h4><i class="fas fa-bullseye"></i> 9.1. Техника применения оружия</h4>
                                <p>Огонь всегда открывается <strong>в центр массы</strong> — область груди. Это наибольшая площадь поражения и расположение жизненно важных органов. Огонь в конечности, предупредительный огонь в воздух или по асфальту — запрещены: непредсказуемы по результату и создают дополнительную угрозу для окружающих.</p>
                                <p>Стрельба продолжается до <strong>полного прекращения агрессивных действий</strong> целью. Это означает: цель упала и не двигается, цель бросила оружие и подняла руки, цель потеряла сознание. Если цель упала, но продолжает удерживать оружие и не выполняет команды — угроза не устранена.</p>
                                <p>После прекращения огня: агент немедленно докладывает в эфир "цель нейтрализована / выстрелы произведены", удерживает оружие направленным на цель до подтверждения безопасности, не приближается к цели в одиночку.</p>
                            </div>

                            <div class="subsection">
                                <h4><i class="fas fa-hand-paper"></i> 9.2. Словесное предупреждение перед выстрелом</h4>
                                <p>Стандартная команда перед применением оружия: <strong>"Стоп! Бросить оружие!"</strong> — громко, четко, однократно. Если ситуация позволяет (есть физическая дистанция, цель не производит выстрел прямо сейчас) — предупреждение обязательно.</p>
                                <p>Предупреждение <strong>не требуется</strong> в следующих случаях: цель уже производит выстрел; цель находится на дистанции удара холодным оружием и движется на агента; любая пауза приведет к немедленной гибели агента или заложника. В этих случаях — немедленный огонь без предупреждения является законным и обоснованным.</p>
                            </div>

                            <div class="subsection">
                                <h4><i class="fas fa-user-injured"></i> 9.3. Действия после применения оружия</h4>
                                <ol>
                                    <li>Доклад командиру: позывной, количество выстрелов, статус цели, свой статус.</li>
                                    <li>Периметр не снимается до полного осмотра — у цели могут быть сообщники в здании.</li>
                                    <li>К нейтрализованной цели подходят двое: один держит под прицелом, второй — проверяет пульс, убирает оружие ногой за пределы досягаемости и надевает наручники. Наручники надеваются на нейтрализованную цель всегда, независимо от визуального состояния.</li>
                                    <li>Оружие цели не поднимается руками — фиксируется место, фотографируется при возможности, сообщается командиру.</li>
                                    <li>Агент, применивший оружие, не дает показаний посторонним до служебного разбора. Все вопросы — только командиру группы.</li>
                                </ol>
                            </div>

                            <div class="subsection">
                                <h4><i class="fas fa-ban"></i> 9.4. Запрещенные основания для открытия огня</h4>
                                <ul class="doc-list">
                                    <li>Вербальные угрозы без оружия в руках ("Я тебя убью" — не является основанием)</li>
                                    <li>Попытка бегства без оружия — беглец задерживается, не уничтожается</li>
                                    <li>Нахождение в розыске — само по себе не дает права на огонь</li>
                                    <li>Приказ третьего лица или гражданского ("Стреляй в него!")</li>
                                    <li>Эмоциональное состояние агента (злость, страх, желание отомстить за коллегу)</li>
                                    <li>Цель обезоружена и лежит на земле — дальнейший огонь является превышением силы</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="rosterSection" class="section">
                    <div class="section-header">
                        <div>
                            <h1><i class="fas fa-users"></i> Личный состав</h1>
                            <p>База данных сотрудников и дисциплинарные взыскания</p>
                        </div>
                    </div>
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <table class="roster-table">
                            <thead>
                                <tr>
                                    <th>Позывной</th>
                                    <th>Звание</th>
                                    <th>Отдел</th>
                                    <th>Статус</th>
                                    <th>Взыскание</th>
                                </tr>
                            </thead>
                            <tbody id="rosterTbody">
                                <!-- Заполняется через JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        // КОНФИГУРАЦИЯ
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTA6JsQdPWCevnaNCzSoWnRfHyrMa1sdv2MHmYcmy06QWWIT6THg7dJZknKnKJL3Qp4OXR5xmzirNeo/pub?output=csv';
        
        let agentsDB = [];
        let fleetDB = [];
        let currentUser = null;
        let currentTheme = 'dark';
        let currentSection = 'public'; // для логики защиты скриншотов

        // ГЛОБАЛЬНЫЕ ФУНКЦИИ
        window.toggleLogin = function() {
            const overlay = document.getElementById('loginOverlay');
            overlay.classList.toggle('hidden');
            if(!overlay.classList.contains('hidden')) {
                document.getElementById('loginMsg').innerText = '';
                document.getElementById('userInput').value = '';
                document.getElementById('passInput').value = '';
                document.getElementById('userInput').focus();
            }
        };

        window.logout = function() {
            currentUser = null;
            sessionStorage.removeItem('mtf7_session');
            sessionStorage.removeItem('mtf7_section');
            document.getElementById('fleetRegisterBtn').classList.add('hidden');
            location.reload();
        };

        window.closeMobileMenu = function() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('mobileOverlay').classList.remove('active');
        };

        window.openMobileMenu = function() {
            document.getElementById('sidebar').classList.add('active');
            document.getElementById('mobileOverlay').classList.add('active');
        };

        // Управление темой
        function initTheme() {
            const savedTheme = localStorage.getItem('mtf-theme');
            if (savedTheme) {
                currentTheme = savedTheme;
                if (currentTheme === 'light') {
                    document.body.classList.add('light-theme');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                }
            }
        }

        function toggleTheme() {
            if (currentTheme === 'dark') {
                currentTheme = 'light';
                document.body.classList.add('light-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                currentTheme = 'dark';
                document.body.classList.remove('light-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            }
            localStorage.setItem('mtf-theme', currentTheme);
        }

        // ЗАПУСК
        document.addEventListener('DOMContentLoaded', () => {
            // Блокировка ПКМ
            document.addEventListener('contextmenu', e => e.preventDefault());
            
            // Вход по Enter для обоих полей
            document.getElementById('userInput').addEventListener('keyup', (e) => {
                if(e.key === "Enter") attemptLogin();
            });
            
            document.getElementById('passInput').addEventListener('keyup', (e) => {
                if(e.key === "Enter") attemptLogin();
            });

            // Инициализация темы
            initTheme();

            // Кнопка переключения темы
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Мобильное меню
            document.getElementById('mobileMenuBtn').addEventListener('click', openMobileMenu);
            document.getElementById('mobileOverlay').addEventListener('click', closeMobileMenu);

            // Закрытие мобильного меню при клике на ссылку
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', closeMobileMenu);
            });

            // Загружаем данные с использованием CORS прокси
            loadDataWithCORS();
        });

        // ЗАГРУЗКА ДАННЫХ С ИСПОЛЬЗОВАНИЕМ CORS ПРОКСИ
        async function loadDataWithCORS() {
            // Проверяем кэш в sessionStorage (данные кэшируются на 5 минут)
            const CACHE_KEY = 'mtf7_data_cache';
            const CACHE_TIME_KEY = 'mtf7_data_cache_time';
            const CACHE_TTL = 5 * 60 * 1000; // 5 минут
            try {
                const cachedData = sessionStorage.getItem(CACHE_KEY);
                const cachedTime = sessionStorage.getItem(CACHE_TIME_KEY);
                if (cachedData && cachedTime && (Date.now() - parseInt(cachedTime)) < CACHE_TTL) {
                    console.log('Используем кэшированные данные');
                    const rows = JSON.parse(cachedData);
                    processData(rows);
                    return;
                }
            } catch(e) { /* игнорируем ошибки кэша */ }

            try {
                // Используем CORS прокси для обхода ограничений
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                const url = corsProxy + encodeURIComponent(SHEET_URL + '&_=' + Date.now());
                
                console.log('Загружаем данные с URL:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ошибка: ${response.status}`);
                }
                
                const csvText = await response.text();
                
                if (!csvText || csvText.trim() === '') {
                    throw new Error('Получен пустой ответ');
                }
                
                // Парсим CSV
                const rows = Papa.parse(csvText, { 
                    header: false, 
                    skipEmptyLines: true,
                    encoding: 'UTF-8'
                }).data;
                
                console.log('Успешно загружено строк:', rows.length);
                console.log('Первые 3 строки для отладки:', rows.slice(0, 3));
                
                // Сохраняем в кэш
                try {
                    sessionStorage.setItem('mtf7_data_cache', JSON.stringify(rows));
                    sessionStorage.setItem('mtf7_data_cache_time', Date.now().toString());
                } catch(e) { /* игнорируем ошибки кэша */ }

                processData(rows);
                
            } catch (error) {
                console.error('Ошибка при загрузке через CORS прокси:', error);
                
                // Пробуем альтернативный метод без прокси
                try {
                    console.log('Пробуем альтернативный метод...');
                    await loadDataDirect();
                } catch (error2) {
                    console.error('Альтернативный метод также не сработал:', error2);
                    showError();
                }
            }
        }

        // ПРЯМАЯ ЗАГРУЗКА БЕЗ ПРОКСИ
        async function loadDataDirect() {
            const url = SHEET_URL + '&_=' + Date.now();
            console.log('Пробуем прямой доступ к:', url);
            
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`HTTP ошибка: ${response.status}`);
            }
            
            const csvText = await response.text();
            
            if (!csvText || csvText.trim() === '') {
                throw new Error('Получен пустой ответ');
            }
            
            // Парсим CSV
            const rows = Papa.parse(csvText, { 
                header: false, 
                skipEmptyLines: true,
                encoding: 'UTF-8'
            }).data;
            
            console.log('Прямая загрузка успешна, строк:', rows.length);
            
            // Сохраняем в кэш
            try {
                sessionStorage.setItem('mtf7_data_cache', JSON.stringify(rows));
                sessionStorage.setItem('mtf7_data_cache_time', Date.now().toString());
            } catch(e) { /* игнорируем ошибки кэша */ }

            processData(rows);
        }

        // ОБРАБОТКА ДАННЫХ
        function processData(rows) {
            fleetDB = [];
            agentsDB = [];
            
            // Проверяем структуру данных - выводим все строки для отладки
            console.log('Все строки для отладки:');
            rows.forEach((row, index) => {
                console.log(`Строка ${index}:`, row);
            });
            
            // Пропускаем заголовок (первую строку)
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                
                // Машины (колонки J, K, L -> индексы 9, 10, 11)
                // Давайте найдем все колонки, которые могут содержать данные о машинах
                for (let j = 0; j < row.length; j++) {
                    if (row[j] && row[j].toString().toLowerCase().includes('car') || 
                        row[j] && row[j].toString().match(/[a-zA-Z]/) && row[j].toString().length > 3) {
                        console.log(`Возможная машина в строке ${i}, колонка ${j}:`, row[j]);
                    }
                }
                
                // Ищем машины по известным индексам
                if (row[9] && row[9].toString().trim() !== '') {
                    fleetDB.push({
                        name: row[9].toString().trim(),
                        owner: row[10] ? row[10].toString().trim() : 'Не указан',
                        speed: row[11] ? row[11].toString().trim() : '-'
                    });
                }
                
                // Агенты (колонки A-G -> индексы 0-6)
                if (row[0] && row[0].toString().trim() !== '') {
                    // Преобразуем все значения к строке для надежности
                    const callsign = row[0].toString().trim();
                    const code = row[1] ? row[1].toString().trim() : '';
                    const rank = row[2] ? row[2].toString().trim() : 'Unknown';
                    const status = row[3] ? row[3].toString().trim() : 'Unknown';
                    const cidStatus = row[4] ? row[4].toString().toLowerCase() : '';
                    const trtStatus = row[5] ? row[5].toString().toLowerCase() : '';
                    const punishment = row[6] ? row[6].toString().trim() : '';
                    
                    agentsDB.push({
                        callsign: callsign,
                        code: code,
                        rank: rank,
                        status: status,
                        isCID: cidStatus.includes('+') || cidStatus.includes('да') || cidStatus.includes('yes') || cidStatus === 'true' || cidStatus === '1',
                        isTRT: trtStatus.includes('+') || trtStatus.includes('да') || trtStatus.includes('yes') || trtStatus === 'true' || trtStatus === '1',
                        punishment: punishment
                    });
                }
            }
            
            console.log('Обработано агентов:', agentsDB.length);
            console.log('Обработано машин:', fleetDB.length);
            console.log('Агенты:', agentsDB);
            console.log('Машины:', fleetDB);
            
            // Рендерим данные
            renderFleet();
            
            // Обновляем сообщение
            updateDataStatus();

            // ВОССТАНОВЛЕНИЕ СЕССИИ (если перезагрузка, а не первый вход)
            if (!currentUser) {
                try {
                    const saved = sessionStorage.getItem('mtf7_session');
                    if (saved) {
                        const { callsign, code } = JSON.parse(saved);
                        const agent = agentsDB.find(a => {
                            const sc = a.callsign.toLowerCase().replace(/\s+/g, '');
                            const ic = callsign.toLowerCase().replace(/\s+/g, '');
                            return sc === ic && a.code === code;
                        });
                        if (agent) {
                            // Пользователь найден — восстанавливаем без уведомления
                            currentUser = agent;
                            buildSecureInterface();
                            // Восстанавливаем раздел
                            const savedSection = sessionStorage.getItem('mtf7_section');
                            if (savedSection) setTimeout(() => switchTab(savedSection), 150);
                            // НЕ показываем sec popup при авто-восстановлении
                            document.getElementById('secPopup')?.classList.add('hidden');
                        } else {
                            // Пользователь удалён из таблицы — чистим сессию
                            sessionStorage.removeItem('mtf7_session');
                            sessionStorage.removeItem('mtf7_section');
                        }
                    }
                } catch(e) {}
            }
        }

        // ОБНОВЛЕНИЕ СТАТУСА ДАННЫХ
        function updateDataStatus() {
            const container = document.getElementById('fleetContainer');
            
            if (agentsDB.length === 0 && fleetDB.length === 0) {
                container.innerHTML = 
                    '<div style="color:var(--warning); text-align: center; padding: 20px;">' +
                    '<i class="fas fa-exclamation-triangle"></i> Данные загружены, но не найдены записи<br>' +
                    '<small>Проверьте структуру Google таблицы</small>' +
                    '</div>';
            } else if (fleetDB.length === 0) {
                container.innerHTML = 
                    '<div style="color:var(--text-dim); text-align: center; padding: 20px;">' +
                    '<i class="fas fa-info-circle"></i> Нет данных о транспорте в базе<br>' +
                    '<small>Агентов загружено: ' + agentsDB.length + '</small>' +
                    '</div>';
            }
        }

        // ОТРИСОВКА МАШИН
        function renderFleet() {
            const container = document.getElementById('fleetContainer');
            
            if (fleetDB.length === 0) {
                updateDataStatus();
                return;
            }
            
            container.innerHTML = '';
            
            fleetDB.forEach(car => {
                const card = document.createElement('div');
                card.className = 'car-card';
                card.innerHTML = `
                    <div class="car-name"><i class="fas fa-car"></i> ${car.name}</div>
                    <div class="car-details">
                        <span><i class="fas fa-user"></i> ${car.owner}</span>
                        <span style="color: var(--accent);">${car.speed}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ПОКАЗ ОШИБКИ
        function showError() {
            document.getElementById('fleetContainer').innerHTML = 
                '<div style="color:var(--danger); padding: 20px; text-align: center;">' +
                '<i class="fas fa-exclamation-triangle"></i> Не удалось загрузить данные<br>' +
                '<small>Попробуйте обновить страницу (F5)</small><br>' +
                '<button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: var(--accent); color: var(--bg-body); border: none; cursor: pointer;">Обновить страницу</button>' +
                '</div>';
        }

        // ЛОГИН
        function attemptLogin() {
            const u = document.getElementById('userInput').value.trim();
            const p = document.getElementById('passInput').value.trim();
            
            if(!u || !p) {
                document.getElementById('loginMsg').innerText = "Заполните все поля";
                return;
            }
            
            if(agentsDB.length === 0) { 
                document.getElementById('loginMsg').innerText = "База данных загружается..."; 
                return; 
            }

            const agent = agentsDB.find(a => {
                // Сравниваем позывной без учета регистра и пробелов
                const inputCallsign = u.toLowerCase().replace(/\s+/g, '');
                const dbCallsign = a.callsign.toLowerCase().replace(/\s+/g, '');
                
                return dbCallsign === inputCallsign && a.code === p;
            });

            if (agent) {
                currentUser = agent;
                toggleLogin();
                buildSecureInterface();
                document.getElementById('loginMsg').innerText = "";
            } else {
                document.getElementById('loginMsg').innerText = "ДОСТУП ЗАПРЕЩЕН - неверный позывной или код";
            }
        }

        // ПОСТРОЕНИЕ ИНТЕРФЕЙСА (ГЛАВНАЯ ЛОГИКА)
        function buildSecureInterface() {
            // Обновляем статус
            document.getElementById('userDisplay').innerHTML = `
                <div style="color: var(--accent);">${currentUser.callsign}</div>
                <div style="font-size:10px; color:var(--success)">${currentUser.rank.toUpperCase()}</div>
            `;

            // ПОКАЗАТЬ КНОПКУ РЕЕСТРА ТРАНСПОРТА ДЛЯ АВТОРИЗОВАННЫХ
            document.getElementById('fleetRegisterBtn').classList.remove('hidden');

            // СКРЫТЬ КНОПКУ АВТОРИЗАЦИИ, ПОКАЗАТЬ КНОПКУ ПЕРЕЗАГРУЗКИ
            document.querySelector('.auth-btn').classList.add('hidden');
            document.getElementById('reloadBtn').classList.add('visible');

            // СОХРАНИТЬ СЕССИЮ
            if (currentUser) {
                try {
                    sessionStorage.setItem('mtf7_session', JSON.stringify({
                        callsign: currentUser.callsign,
                        code: currentUser.code
                    }));
                } catch(e) {}
            }

            // ПОКАЗАТЬ УВЕДОМЛЕНИЕ БЕЗОПАСНОСТИ
            showSecPopup();

            const nav = document.getElementById('navMenu');
            // Сброс меню
            let menuHTML = `<button onclick="switchTab('public'); closeMobileMenu();" class="nav-btn active"><i class="fas fa-globe"></i> Общая информация</button>`;

            const r = currentUser.rank.toLowerCase();
            const isTrainee = r.includes('trainee') || r.includes('cadet') || r.includes('стажер') || r.includes('tr.mtf');
            const isCommander = r.includes('commander') || r.includes('deputy') || r.includes('sub') || r.includes('c.mtf') || r.includes('sub.mtf');
            const isSenior = r.includes('senior') || r.includes('s.mtf');

            // --- ЛОГИКА ОТОБРАЖЕНИЯ ---
            
            if (isTrainee) {
                // СТАЖЕР: Видит только обучение и устав
                menuHTML += `<div class="nav-category">ОБУЧЕНИЕ</div>`;
                menuHTML += `<button onclick="switchTab('traineeSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-user-graduate"></i> Для стажера</button>`;
                menuHTML += `<button onclick="switchTab('structureSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-sitemap"></i> Структура MTF-7</button>`;
                menuHTML += `<button onclick="switchTab('charterSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-book"></i> Устав группы</button>`;
                menuHTML += `<button onclick="switchTab('punishmentSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-gavel"></i> Система наказаний</button>`;
                
                // Сразу открываем раздел стажера
                setTimeout(() => switchTab('traineeSection'), 100);
            } else {
                // АГЕНТ: Не видит "Раздел Стажера". Видит работу.
                menuHTML += `<div class="nav-category">РАБОЧАЯ ЗОНА</div>`;
                menuHTML += `<button onclick="switchTab('structureSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-sitemap"></i> Структура MTF-7</button>`;
                menuHTML += `<button onclick="switchTab('charterSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-book"></i> Устав группы</button>`;
                menuHTML += `<button onclick="switchTab('punishmentSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-gavel"></i> Система наказаний</button>`;
                
                if (currentUser.isCID) {
                    menuHTML += `<button onclick="switchTab('cidSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-search"></i> Протоколы CID</button>`;
                }
                if (currentUser.isTRT) {
                    menuHTML += `<button onclick="switchTab('trtSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-crosshairs"></i> Протоколы TRT</button>`;
                }
                
                // Сразу открываем Устав или первый доступный раздел
                setTimeout(() => switchTab('structureSection'), 100);
            }

            if (isCommander || isSenior) {
                menuHTML += `<div class="nav-category" style="color:var(--danger)">УПРАВЛЕНИЕ</div>`;
                menuHTML += `<button onclick="switchTab('rosterSection'); closeMobileMenu();" class="nav-btn"><i class="fas fa-users"></i> Личный состав</button>`;
                setTimeout(() => renderRoster(), 100);
            }

            // Кнопка выхода
            menuHTML += `<button onclick="logout()" class="nav-btn" style="margin-top:20px; color:var(--danger)"><i class="fas fa-sign-out-alt"></i> ВЫХОД</button>`;
            
            nav.innerHTML = menuHTML;
        }

        // СОСТАВ — ЧИСТАЯ ТАБЛИЦА
        function renderRoster() {
            const tbody = document.getElementById('rosterTbody');
            if (!tbody) return;
            tbody.innerHTML = '';

            agentsDB.forEach(a => {
                let depts = [];
                if (a.isTRT) depts.push('TRT');
                if (a.isCID) depts.push('CID');

                const hasPunish = a.punishment && a.punishment.trim() !== '';
                const isCmd = a.rank.toLowerCase().includes('commander') || a.rank.toLowerCase().includes('sub');

                let statusClass = 's-leave';
                if (a.status.toLowerCase().includes('active'))   statusClass = 's-active';
                else if (a.status.toLowerCase().includes('inactive')) statusClass = 's-inactive';

                let rowClass = hasPunish ? 'row-punished' : (isCmd ? 'row-commander' : '');

                const tr = document.createElement('tr');
                tr.className = rowClass;
                tr.innerHTML = `
                    <td class="roster-td-callsign">${a.callsign}</td>
                    <td class="roster-td-rank">${a.rank}</td>
                    <td class="roster-td-dept">${depts.join(' / ') || '—'}</td>
                    <td class="roster-td-status ${statusClass}">${a.status}</td>
                    <td class="roster-td-punish">${hasPunish ? a.punishment : '—'}</td>
                `;
                tr.addEventListener('click', () => openAgentModal(a));
                tbody.appendChild(tr);
            });
        }

        // МОДАЛ АГЕНТА
        window.openAgentModal = function(a) {
            document.getElementById('modalCallsign').textContent = a.callsign;
            document.getElementById('modalRank').textContent = a.rank.toUpperCase();

            let depts = [];
            if (a.isTRT) depts.push('TRT');
            if (a.isCID) depts.push('CID');

            let statusColor = a.status.toLowerCase().includes('active') ? 'var(--success)'
                : a.status.toLowerCase().includes('inactive') ? 'var(--danger)' : 'var(--warning)';

            let punishRow = a.punishment && a.punishment.trim() !== ''
                ? `<div class="agent-modal-row"><span class="row-label">Взыскание</span><span class="row-value" style="color:var(--danger)">${a.punishment}</span></div>`
                : `<div class="agent-modal-row"><span class="row-label">Взыскание</span><span class="row-value" style="color:var(--success)">Отсутствует</span></div>`;

            document.getElementById('modalBody').innerHTML = `
                <div class="agent-modal-row"><span class="row-label">Звание</span><span class="row-value">${a.rank}</span></div>
                <div class="agent-modal-row"><span class="row-label">Отдел</span><span class="row-value">${depts.join(' / ') || 'Не назначен'}</span></div>
                <div class="agent-modal-row"><span class="row-label">Статус</span><span class="row-value" style="color:${statusColor}">${a.status}</span></div>
                ${punishRow}
            `;

            document.getElementById('agentModal').classList.add('open');
        };

        window.closeAgentModal = function(e) {
            if (e.target === document.getElementById('agentModal')) {
                document.getElementById('agentModal').classList.remove('open');
            }
        };

        // === ЗАЩИТА ОТ СКРИНШОТОВ v3 ===
        // Логика: щит активен только когда currentSection !== 'public' И пользователь залогинен
        // ПК: блокируем по клавишам + blur
        // Мобайл: visibilitychange (смена вкладки / переход в другое приложение)
        (function() {
            const shield = document.getElementById('screenshotShield');
            if (!shield) return;

            const heldKeys = new Set();
            let hideTimer = null;
            let shieldPCTimer = null; // для авто-скрытия после ПКМ

            function isProtectedPage() {
                // Защита только если залогинен и не на публичной странице
                return currentUser !== null && currentSection !== 'public';
            }

            function showShield() {
                if (!isProtectedPage()) return;
                shield.style.display = 'block';
                clearTimeout(hideTimer);
                // Затираем буфер обмена дважды
                setTimeout(() => { try { navigator.clipboard.writeText('').catch(()=>{}); } catch(e){} }, 60);
                setTimeout(() => { try { navigator.clipboard.writeText('').catch(()=>{}); } catch(e){} }, 600);
            }

            function hideShield(delay) {
                clearTimeout(hideTimer);
                hideTimer = setTimeout(() => { shield.style.display = 'none'; }, delay || 0);
            }

            // === ПК: перехват клавиш ===
            function isDangerous() {
                if (heldKeys.has('PrintScreen')) return true;
                if (heldKeys.has('Meta') && heldKeys.has('Shift')) return true;
                if (heldKeys.has('Alt')) return true;
                return false;
            }

            document.addEventListener('keydown', function(e) {
                heldKeys.add(e.key);
                if (isDangerous()) {
                    showShield();
                    e.preventDefault();
                }
            }, true);

            document.addEventListener('keyup', function(e) {
                heldKeys.delete(e.key);
                if (!isDangerous()) {
                    hideShield(1200);
                }
            }, true);

            // ПКМ убирает щит через ~200мс (чтобы не мешало работе с сайтом)
            document.addEventListener('mousedown', function(e) {
                if (e.button === 2 && shield.style.display === 'block') {
                    clearTimeout(hideTimer);
                    clearTimeout(shieldPCTimer);
                    shieldPCTimer = setTimeout(() => {
                        heldKeys.clear();
                        shield.style.display = 'none';
                    }, 200);
                }
            });

            document.addEventListener('dragstart', e => e.preventDefault());
        })();

        // ПЕРЕКЛЮЧЕНИЕ ВКЛАДОК
        window.switchTab = function(id) {
            currentSection = id;
            // Сохраняем текущий раздел для восстановления после перезагрузки
            if (currentUser) {
                try { sessionStorage.setItem('mtf7_section', id); } catch(e) {}
            }

            // Скрыть все секции
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            // Убрать активный класс у кнопок
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            // Показать нужную секцию
            const section = document.getElementById(id);
            if(section) {
                section.classList.add('active');
            }
            
            // Подсветить кнопку (ищем по onclick аттрибуту)
            const btns = document.querySelectorAll('.nav-btn');
            btns.forEach(btn => {
                const onclickAttr = btn.getAttribute('onclick');
                if(onclickAttr && onclickAttr.includes(id)) {
                    btn.classList.add('active');
                }
            });

            // Обновить заголовок
            const titles = {
                'public': 'ОБЩАЯ ИНФОРМАЦИЯ',
                'traineeSection': 'ДЛЯ СТАЖЕРА',
                'structureSection': 'СТРУКТУРА MTF-7',
                'charterSection': 'УСТАВ ГРУППЫ',
                'punishmentSection': 'СИСТЕМА НАКАЗАНИЙ',
                'cidSection': 'ПРОТОКОЛЫ CID',
                'trtSection': 'ПРОТОКОЛЫ TRT',
                'rosterSection': 'ЛИЧНЫЙ СОСТАВ'
            };
            document.getElementById('pageTitle').innerText = titles[id] || 'SECURE ACCESS';
            
            // Прокрутка вверх на мобильных
            if (window.innerWidth <= 768) {
                document.querySelector('.scroll-container').scrollTop = 0;
            }
        }
        // === УВЕДОМЛЕНИЕ БЕЗОПАСНОСТИ ===
        function showSecPopup() {
            const popup = document.getElementById('secPopup');
            if (popup) popup.classList.remove('hidden');
        }

        window.closeSecPopup = function() {
            const popup = document.getElementById('secPopup');
            if (popup) popup.classList.add('hidden');
        };

        // === МЯГКАЯ ПЕРЕЗАГРУЗКА (без выброса из сессии) ===
        window.softReload = async function() {
            const btn = document.getElementById('reloadBtn');
            const icon = btn ? btn.querySelector('i') : null;
            if (icon) icon.classList.add('fa-spin');

            // Сбрасываем кэш
            try {
                sessionStorage.removeItem('mtf7_data_cache');
                sessionStorage.removeItem('mtf7_data_cache_time');
            } catch(e) {}

            try {
                await loadDataWithCORS();
            } catch(e) {}

            // После перезагрузки данных — перерисовываем то, что видит пользователь
            if (currentUser) {
                // Обновляем состав если открыт
                if (currentSection === 'rosterSection') {
                    renderRoster();
                }
                // Проверяем что текущий пользователь ещё есть в базе
                const stillExists = agentsDB.find(a => {
                    const sc = a.callsign.toLowerCase().replace(/\s+/g, '');
                    const ic = currentUser.callsign.toLowerCase().replace(/\s+/g, '');
                    return sc === ic && a.code === currentUser.code;
                });
                if (!stillExists) {
                    // Удалён из таблицы — выход
                    sessionStorage.removeItem('mtf7_session');
                    sessionStorage.removeItem('mtf7_section');
                    location.reload();
                    return;
                }
                // Обновляем объект currentUser свежими данными из таблицы
                currentUser = stillExists;
            }

            if (icon) icon.classList.remove('fa-spin');
        };

        // Drag logic для sec-popup
        (function() {
            const popup = document.getElementById('secPopup');
            const handle = document.getElementById('secPopupDrag');
            if (!popup || !handle) return;

            let isDragging = false;
            let startX, startY, origLeft, origTop;

            function ensureAbsolutePos() {
                const r = popup.getBoundingClientRect();
                popup.style.bottom = 'auto';
                popup.style.right = 'auto';
                popup.style.left = r.left + 'px';
                popup.style.top = r.top + 'px';
            }

            function onMove(clientX, clientY) {
                if (!isDragging) return;
                let newLeft = origLeft + (clientX - startX);
                let newTop  = origTop  + (clientY - startY);
                newLeft = Math.max(0, Math.min(window.innerWidth  - popup.offsetWidth,  newLeft));
                newTop  = Math.max(0, Math.min(window.innerHeight - popup.offsetHeight, newTop));
                popup.style.left = newLeft + 'px';
                popup.style.top  = newTop  + 'px';
            }

            handle.addEventListener('mousedown', e => {
                ensureAbsolutePos();
                isDragging = true;
                startX = e.clientX; startY = e.clientY;
                origLeft = parseInt(popup.style.left); origTop = parseInt(popup.style.top);
                document.body.style.userSelect = 'none';
            });
            document.addEventListener('mousemove', e => onMove(e.clientX, e.clientY));
            document.addEventListener('mouseup', () => { isDragging = false; document.body.style.userSelect = ''; });

            handle.addEventListener('touchstart', e => {
                ensureAbsolutePos();
                isDragging = true;
                startX = e.touches[0].clientX; startY = e.touches[0].clientY;
                origLeft = parseInt(popup.style.left); origTop = parseInt(popup.style.top);
            }, { passive: true });
            document.addEventListener('touchmove', e => {
                if (!isDragging) return;
                onMove(e.touches[0].clientX, e.touches[0].clientY);
            }, { passive: true });
            document.addEventListener('touchend', () => { isDragging = false; });
        })();

    </script>
</body>
</html>